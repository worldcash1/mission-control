---
tags:
  - projects/marriott-scanner
  - automation
---

# 2026-01-30 - MMP Scanner Major Session

## Marriott MMP Scanner - v2.0 Released

### What We Built
- **Full-stack hotel rate scanner** for Marriott MMP (Meeting Planner) corporate rates
- **Tech stack:** Next.js + Convex + Playwright + Vercel
- **Live URL:** https://marriott-scanner.vercel.app
- **Repo:** worldcash1/marriott-scanner
- **Convex:** sleek-guanaco-39

### Features Implemented (v1.0 → v2.0)
1. City/hotel selection with checkboxes
2. 12 months out date range (Feb 2026 - Jan 2027)
3. Hotel filtering - only show selected hotels
4. Skeleton placeholders for hotels without data
5. "Scan Now" button triggers watcher via Convex
6. **Real-time progress:** Progress bar, hotel highlighting, current hotel indicator
7. Timestamp showing data freshness ("5m ago")
8. Version stamping in footer (v2.0)

### Hotels Configured
- **Hong Kong:** 12 hotels (HKGDT, HKGHV, HKGXR, etc.)
- **Tokyo:** 15 hotels (TYORZ, TYOMC, TYOSW, etc.)
- **Singapore:** 11 hotels
- **Bangkok:** 12 hotels
- **Total:** 50 hotels across 4 cities

### Architecture
```
User clicks "Scan Now" 
    → Writes to Convex scanRequests table
    → Watcher (Mac Mini) polls/subscribes to Convex
    → Watcher runs Playwright scanner
    → Scanner saves prices to Convex
    → Frontend auto-updates via Convex subscriptions
```

### CRITICAL ISSUE: Akamai Blocking
- **Status:** Scanner is blocked by Marriott's Akamai bot protection
- **Error:** 403 Forbidden / "Access Denied"
- **Cause:** Too many requests too fast (2-5 second delays)
- **IP is flagged** - confirmed with curl test returning 403

### Solutions Discussed
1. **Wait 24-48h** for block to reset
2. **Improve scanner:** 60s delays, randomization, cookie clearing
3. **Residential proxy:** ~$20-50/mo (Bright Data, Smartproxy)
4. **Marriott Developer Portal:** https://devportalprod.marriott.com/apis (official API, needs approval)
5. **Mobile app reverse engineering:** Use mitmproxy to capture Marriott app API calls

### What Should Have Been Done
- Longer delays (30-60s between hotels, not 2-5s)
- Limit to 3-5 hotels per session
- Randomize timing
- Clear cookies between requests
- Run at off-peak hours (3 AM)

### Key Hotel Codes Discovered
- Four Points Flex Tokyo Shibuya West: **TYOSW** (confirmed has MMP)
- Tokyo Marriott: **TYOMC** (not TYOMR)
- Ritz-Carlton Tokyo: **TYORZ** (not TYORC)
- Westin Tokyo: **TYOWI** (not TYOWE)
- Courtyard Tokyo Ginza: **TYOCY**
- AC Hotel Tokyo Ginza: **TYOAR**

### Versioning Pattern Established
Per Nam's request - all projects should have:
1. `APP_VERSION = 'vX.Y'` in code
2. Version displayed in UI footer
3. Commit messages: `vX.Y: Description`
4. Notify Nam when pushing with version + changes

### Next Steps
1. Wait for IP block to reset (~24h)
2. Improve scanner with anti-detection measures
3. Consider mobile app API reverse engineering for long-term stability
4. Test with ONE hotel first, then slowly scale up

### Files Modified
- `~/projects/marriott-scanner/src/app/page.tsx` - Main UI
- `~/projects/marriott-scanner/scripts/scanner.ts` - Playwright scanner
- `~/projects/marriott-scanner/scripts/watcher.ts` - Convex watcher
- `~/projects/marriott-scanner/convex/scanRequests.ts` - Scan queue
- `~/projects/marriott-scanner/convex/prices.ts` - Price storage
- `~/projects/marriott-scanner/convex/schema.ts` - Database schema

### Watcher Location
- Runs on Mac Mini: `~/logs/mmp-watcher.log`
- Start command: `cd ~/projects/marriott-scanner && npx tsx scripts/watcher.ts`
