<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Control</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://unpkg.com/convex@1.17.4/dist/browser.bundle.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #111111;
      color: #e5e5e5;
      min-height: 100vh;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 240px;
      background: #161616;
      border-right: 1px solid #232323;
      padding: 20px 14px 20px 20px;
      display: flex;
      flex-direction: column;
      height: 100vh;
      position: fixed;
      overflow: hidden;
    }

    .sidebar-nav {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      margin-right: -14px;
      padding-right: 14px;
    }

    .sidebar-nav::-webkit-scrollbar {
      width: 4px;
    }

    .sidebar-nav::-webkit-scrollbar-track {
      background: transparent;
    }

    .sidebar-nav::-webkit-scrollbar-thumb {
      background: #333;
      border-radius: 2px;
    }

    .sidebar-header {
      padding: 0 0 24px 0;
      border-bottom: 1px solid #232323;
      margin-bottom: 20px;
    }

    .sidebar-header h1 {
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-section {
      padding: 0;
      margin-bottom: 28px;
    }

    .nav-label {
      font-size: 13px;
      font-weight: 500;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 0 4px;
      margin-bottom: 10px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      color: #999;
      transition: all 0.15s;
    }

    .nav-item:hover {
      background: #1f1f1f;
      color: #e5e5e5;
    }

    .nav-item.active {
      background: #1f1f1f;
      color: #fff;
    }

    .nav-item .count {
      margin-left: auto;
      font-size: 12px;
      color: #555;
    }

    .nav-item.active .count {
      color: #888;
    }

    .sidebar-footer {
      margin-top: auto;
      padding: 20px 0;
      border-top: 1px solid #232323;
      font-size: 12px;
      color: #555;
    }

    /* Search */
    .search-box {
      position: relative;
      margin-bottom: 20px;
    }

    .search-box input {
      width: 100%;
      padding: 10px 14px 10px 38px;
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      color: #e5e5e5;
      font-size: 13px;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-box input:focus {
      border-color: #4ade80;
    }

    .search-box input::placeholder {
      color: #555;
    }

    .search-box svg {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      color: #555;
    }

    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      margin-top: 4px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 100;
      display: none;
    }

    .search-results.active {
      display: block;
    }

    .search-result-item {
      padding: 12px 16px;
      cursor: pointer;
      border-bottom: 1px solid #232323;
    }

    .search-result-item:hover {
      background: #252525;
    }

    .search-result-item:last-child {
      border-bottom: none;
    }

    .search-result-item .title {
      color: #e5e5e5;
      font-size: 14px;
    }

    .search-result-item .type {
      color: #666;
      font-size: 12px;
      margin-top: 2px;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        padding: 16px;
        border-right: none;
        border-bottom: 1px solid #232323;
      }

      .sidebar-header {
        padding: 0 0 16px 0;
        margin-bottom: 12px;
      }

      .nav-section {
        margin-bottom: 16px;
      }

      .nav-item {
        padding: 10px;
        font-size: 14px;
      }

      .sidebar-footer {
        display: none;
      }

      .main {
        margin-left: 0 !important;
        padding: 20px 16px;
      }

      .page-header h2 {
        font-size: 22px;
      }

      .stats-row {
        flex-wrap: wrap;
      }

      .stat-box {
        flex: 1 1 45%;
        min-width: 120px;
      }

      .table-container {
        overflow-x: auto;
      }

      .table {
        min-width: 600px;
      }

      .section {
        margin-bottom: 20px;
      }

      .idea-item {
        padding: 12px;
      }

      .activity-item {
        padding: 10px 0;
      }
    }

    @media (max-width: 480px) {
      .stats-row {
        gap: 8px;
      }

      .stat-box {
        flex: 1 1 100%;
        padding: 10px 14px;
      }

      .nav-item {
        padding: 8px;
        font-size: 13px;
      }

      .page-header h2 {
        font-size: 20px;
      }
    }

    .nav-item svg,
    .icon svg {
      width: 18px;
      height: 18px;
      stroke-width: 1.5;
    }

    .section-title svg {
      width: 16px;
      height: 16px;
      stroke-width: 1.5;
      vertical-align: -3px;
      margin-right: 8px;
    }

    /* Main Content */
    .main {
      flex: 1;
      margin-left: 240px;
      padding: 28px 36px;
      min-height: 100vh;
    }

    .page-header {
      margin-bottom: 24px;
    }

    .page-header-main {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .page-header h2 {
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 4px;
    }

    .page-header p {
      font-size: 13px;
      color: #666;
    }

    .tz-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #1a1a1a;
      border: 1px solid #252525;
      border-radius: 8px;
      padding: 8px 12px;
    }

    .tz-time {
      font-size: 14px;
      font-weight: 600;
      font-family: 'SF Mono', Monaco, monospace;
      color: #fff;
    }

    .tz-label {
      font-size: 11px;
      color: #666;
      text-transform: uppercase;
    }

    /* Stats Row */
    .stats-row {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }

    .stat-box {
      background: #181818;
      border: 1px solid #252525;
      border-radius: 8px;
      padding: 10px 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-box .value {
      font-size: 18px;
      font-weight: 600;
      color: #fff;
    }

    .stat-box .label {
      font-size: 12px;
      color: #666;
    }

    .stat-box .sub {
      font-size: 10px;
      color: #555;
    }

    /* Section */
    .section {
      margin-bottom: 24px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .section-title {
      font-size: 12px;
      font-weight: 600;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .section-action {
      font-size: 12px;
      color: #666;
      cursor: pointer;
    }

    .section-action:hover {
      color: #999;
    }

    /* Table */
    .table-container {
      background: #181818;
      border: 1px solid #252525;
      border-radius: 12px;
      overflow: hidden;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table th {
      text-align: left;
      padding: 12px 16px;
      font-size: 11px;
      font-weight: 500;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid #252525;
      background: #1a1a1a;
    }

    .table td {
      padding: 14px 16px;
      font-size: 14px;
      border-bottom: 1px solid #202020;
    }

    .table tr:last-child td {
      border-bottom: none;
    }

    .table tr:hover {
      background: #1c1c1c;
    }

    .table tr.clickable {
      cursor: pointer;
    }

    .table .title {
      font-weight: 500;
      color: #e5e5e5;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .table .title .chevron {
      width: 14px;
      height: 14px;
      transition: transform 0.2s;
      color: #555;
    }

    .table tr.expanded .chevron {
      transform: rotate(90deg);
    }

    .table .desc {
      font-size: 13px;
      color: #666;
      margin-top: 3px;
    }

    .table .expanded-content {
      background: #1a1a1a;
      padding: 20px 24px;
      border-bottom: 1px solid #252525;
    }

    .expanded-content .detail-row {
      display: flex;
      margin-bottom: 12px;
    }

    .expanded-content .detail-label {
      width: 100px;
      font-size: 14px;
      color: #666;
      flex-shrink: 0;
    }

    .expanded-content .detail-value {
      font-size: 15px;
      color: #bbb;
      line-height: 1.5;
    }

    .expanded-content .subtasks {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #252525;
    }

    .expanded-content .subtask {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 0;
      font-size: 15px;
      color: #999;
    }

    .expanded-content .subtask-check {
      color: #555;
    }

    .expanded-content .subtask.done {
      color: #666;
      text-decoration: line-through;
    }

    .expanded-content .subtask.done .subtask-check {
      color: #4ade80;
    }

    /* Status Badge */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge-active {
      background: #1e2a3a;
      color: #5b9bf5;
    }

    .badge-done {
      background: #1a2e1a;
      color: #5bbf5b;
    }

    .badge-queue {
      background: #252525;
      color: #888;
    }

    .badge-blocked {
      background: #2e261a;
      color: #d4a33a;
    }

    .badge-idea {
      background: #2a1e3a;
      color: #a585d4;
    }

    /* Progress */
    .progress {
      width: 100px;
      height: 6px;
      background: #252525;
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: #5b9bf5;
      border-radius: 3px;
    }

    .progress-text {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    /* Activity List */
    .activity-list {
      background: #181818;
      border: 1px solid #252525;
      border-radius: 12px;
    }

    .activity-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      border-bottom: 1px solid #202020;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-time {
      font-size: 12px;
      color: #555;
      min-width: 70px;
    }

    .activity-dot {
      width: 6px;
      height: 6px;
      background: #333;
      border-radius: 50%;
    }

    .activity-dot.active {
      background: #5b9bf5;
    }

    .activity-text {
      font-size: 13px;
      color: #aaa;
    }

    /* Ideas List */
    .ideas-list {
      background: #181818;
      border: 1px solid #252525;
      border-radius: 12px;
    }

    .idea-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 12px 16px;
      border-bottom: 1px solid #202020;
    }

    .idea-item:last-child {
      border-bottom: none;
    }

    .idea-icon {
      font-size: 12px;
      margin-top: 2px;
    }

    .idea-title {
      font-size: 14px;
      color: #e5e5e5;
      margin-bottom: 3px;
    }

    .idea-desc {
      font-size: 13px;
      color: #666;
    }

    /* Current Task Banner */
    .current-banner {
      background: linear-gradient(135deg, #1a2535 0%, #1d1a2e 100%);
      border: 1px solid #2a3545;
      border-radius: 10px;
      padding: 12px 16px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .current-banner .dot {
      width: 8px;
      height: 8px;
      background: #5b9bf5;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .current-banner .text {
      flex: 1;
      font-size: 13px;
      color: #c5d5f5;
    }

    .current-banner .time {
      font-size: 11px;
      color: #667799;
    }

    /* Daily Logs */
    .daily-logs-container {
      display: flex;
      gap: 24px;
      min-height: 500px;
    }

    .daily-logs-sidebar {
      width: 200px;
      flex-shrink: 0;
      background: #181818;
      border: 1px solid #252525;
      border-radius: 12px;
      padding: 16px;
      max-height: 600px;
      overflow-y: auto;
    }

    .daily-log-item {
      padding: 12px 14px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 4px;
      transition: all 0.15s;
    }

    .daily-log-item:hover {
      background: #252525;
    }

    .daily-log-item.active {
      background: #1e2a3a;
      border-left: 3px solid #5b9bf5;
    }

    .daily-log-item .day {
      font-size: 14px;
      color: #e5e5e5;
      font-weight: 500;
    }

    .daily-log-item .date {
      font-size: 12px;
      color: #666;
      margin-top: 2px;
    }

    .daily-logs-content {
      flex: 1;
      background: #181818;
      border: 1px solid #252525;
      border-radius: 12px;
      overflow: hidden;
    }

    .daily-log-header {
      padding: 20px 24px;
      border-bottom: 1px solid #252525;
      background: #1a1a1a;
    }

    .daily-log-header .daily-log-date {
      font-size: 18px;
      font-weight: 600;
      color: #fff;
    }

    .daily-log-body {
      padding: 24px;
      max-height: 500px;
      overflow-y: auto;
      color: #ccc;
      line-height: 1.7;
    }

    .daily-log-body h1,
    .daily-log-body h2,
    .daily-log-body h3 {
      color: #fff;
      margin-top: 24px;
      margin-bottom: 12px;
    }

    .daily-log-body h1 { font-size: 22px; margin-top: 0; }
    .daily-log-body h2 { font-size: 18px; color: #5b9bf5; }
    .daily-log-body h3 { font-size: 16px; color: #888; }

    .daily-log-body ul, .daily-log-body ol {
      margin: 12px 0;
      padding-left: 24px;
    }

    .daily-log-body li {
      margin-bottom: 8px;
    }

    .daily-log-body code {
      background: #252525;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
    }

    .daily-log-body pre {
      background: #1a1a1a;
      border: 1px solid #252525;
      border-radius: 8px;
      padding: 16px;
      overflow-x: auto;
      margin: 16px 0;
    }

    .daily-log-body pre code {
      background: none;
      padding: 0;
    }

    .daily-log-body strong {
      color: #fff;
    }

    .daily-log-body a {
      color: #5b9bf5;
      text-decoration: none;
    }

    .daily-log-body a:hover {
      text-decoration: underline;
    }

    .daily-log-body blockquote {
      border-left: 3px solid #5b9bf5;
      margin: 16px 0;
      padding-left: 16px;
      color: #999;
    }

    @media (max-width: 768px) {
      .daily-logs-container {
        flex-direction: column;
      }
      .daily-logs-sidebar {
        width: 100%;
        max-height: 200px;
      }
    }

    /* To-Do List */
    .todos-container {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .todo-priority-section {
      background: #181818;
      border: 1px solid #252525;
      border-radius: 12px;
      overflow: hidden;
    }

    .todo-priority-header {
      padding: 16px 20px;
      border-bottom: 1px solid #252525;
      font-weight: 600;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .todo-priority-header.high { color: #f87171; }
    .todo-priority-header.medium { color: #fbbf24; }
    .todo-priority-header.low { color: #4ade80; }
    .todo-priority-header.completed { color: #666; }

    .todo-list {
      padding: 8px;
    }

    .todo-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 8px;
      transition: background 0.15s;
    }

    .todo-item:hover {
      background: #1f1f1f;
    }

    .todo-checkbox {
      width: 18px;
      height: 18px;
      border: 2px solid #444;
      border-radius: 4px;
      flex-shrink: 0;
      margin-top: 2px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .todo-item.completed .todo-checkbox {
      background: #4ade80;
      border-color: #4ade80;
    }

    .todo-content {
      flex: 1;
    }

    .todo-text {
      color: #e5e5e5;
      font-size: 14px;
      line-height: 1.5;
    }

    .todo-item.completed .todo-text {
      color: #666;
      text-decoration: line-through;
    }

    .todo-meta {
      display: flex;
      gap: 12px;
      margin-top: 6px;
      font-size: 12px;
      color: #666;
    }

    .todo-due {
      color: #f87171;
    }

    .todo-project {
      color: #5b9bf5;
    }

    .todo-empty {
      padding: 40px;
      text-align: center;
      color: #555;
    }

    /* Tasks System Styles */
    .tasks-stats-bar {
      display: flex;
      gap: 24px;
      padding: 16px 0;
      margin-bottom: 16px;
      border-bottom: 1px solid #1a1a2e;
    }

    .tasks-stat {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .tasks-stat-value {
      font-size: 20px;
      font-weight: 600;
      color: #e0e0e0;
    }

    .tasks-stat-label {
      font-size: 11px;
      color: #555;
    }

    .tasks-reminders-strip {
      background: #f472b608;
      border: 1px solid #f472b615;
      border-radius: 10px;
      padding: 12px 16px;
      margin-bottom: 16px;
    }

    .tasks-reminders-strip-header {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #f472b6;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tasks-reminder-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 0;
      font-size: 12px;
    }

    .tasks-reminder-time {
      color: #f472b6;
      font-weight: 500;
      min-width: 80px;
    }

    .tasks-reminder-text {
      color: #999;
    }

    .tasks-toolbar {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 0;
      margin-bottom: 16px;
    }

    .tasks-filter-tabs {
      display: flex;
      gap: 2px;
      background: #111119;
      border-radius: 8px;
      padding: 3px;
    }

    .tasks-filter-tab {
      padding: 6px 14px;
      font-size: 12px;
      border-radius: 6px;
      cursor: pointer;
      color: #666;
      transition: all 0.15s;
      border: none;
      background: none;
    }

    .tasks-filter-tab.active {
      background: #1e1e30;
      color: #e0e0e0;
    }

    .tasks-filter-tab:hover:not(.active) {
      color: #999;
    }

    .tasks-filter-tab .dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      margin-right: 6px;
    }

    .tasks-filter-tab .dot.all { background: #818cf8; }
    .tasks-filter-tab .dot.personal { background: #f59e0b; }
    .tasks-filter-tab .dot.project { background: #10b981; }
    .tasks-filter-tab .dot.reminder { background: #f472b6; }

    .tasks-toolbar-right {
      margin-left: auto;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .tasks-search-box {
      background: #111119;
      border: 1px solid #1a1a2e;
      border-radius: 8px;
      padding: 7px 12px;
      font-size: 12px;
      color: #e0e0e0;
      width: 200px;
      outline: none;
    }

    .tasks-search-box:focus {
      border-color: #333;
    }

    .tasks-search-box::placeholder {
      color: #444;
    }

    .tasks-btn-add {
      background: #818cf8;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 7px 16px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.15s;
    }

    .tasks-btn-add:hover {
      background: #6366f1;
    }

    .tasks-group {
      margin: 20px 0;
    }

    .tasks-group-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 0;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #555;
      cursor: pointer;
    }

    .tasks-group-header .group-count {
      color: #444;
      font-size: 10px;
    }

    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 10px;
      margin: 2px 0;
      transition: all 0.15s;
      cursor: pointer;
      position: relative;
    }

    .task-item:hover {
      background: #ffffff06;
    }

    .task-item:hover .task-actions {
      opacity: 1;
    }

    .task-check {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid #333;
      flex-shrink: 0;
      margin-top: 1px;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .task-check:hover {
      border-color: #818cf8;
    }

    .task-check.checked {
      background: #818cf8;
      border-color: #818cf8;
    }

    .task-check.checked::after {
      content: 'âœ“';
      color: white;
      font-size: 11px;
    }

    .task-check.high { border-color: #f87171; }
    .task-check.medium { border-color: #fbbf24; }
    .task-check.low { border-color: #4ade80; }

    .task-body {
      flex: 1;
      min-width: 0;
    }

    .task-title {
      font-size: 13.5px;
      color: #e0e0e0;
      line-height: 1.4;
    }

    .task-item.done .task-title {
      color: #555;
      text-decoration: line-through;
    }

    .task-desc {
      font-size: 12px;
      color: #555;
      margin-top: 2px;
    }

    .task-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
      flex-wrap: wrap;
    }

    .task-tag {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 500;
    }

    .tag-project { background: #10b98115; color: #10b981; }
    .tag-personal { background: #f59e0b15; color: #f59e0b; }
    .tag-category { background: #ffffff08; color: #666; }
    .tag-assignee { background: #818cf815; color: #818cf8; }

    .task-due {
      font-size: 11px;
      color: #555;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .task-due.overdue { color: #f87171; }
    .task-due.today { color: #fbbf24; }
    .task-due.upcoming { color: #555; }

    .task-reminder-badge {
      font-size: 11px;
      color: #f472b6;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .task-actions {
      position: absolute;
      right: 12px;
      top: 12px;
      display: flex;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.15s;
    }

    .task-action-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: none;
      background: #1a1a2e;
      color: #888;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }

    .task-action-btn:hover {
      background: #252540;
      color: #e0e0e0;
    }

    .task-action-btn.delete:hover {
      background: #3b1111;
      color: #f87171;
    }

    .add-task-inline {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      border-radius: 10px;
      margin: 2px 0;
      border: 1px dashed #1a1a2e;
      cursor: pointer;
      transition: all 0.15s;
    }

    .add-task-inline:hover {
      border-color: #333;
      background: #ffffff03;
    }

    .add-task-inline span {
      color: #444;
      font-size: 13px;
    }

    /* Task Modal */
    .task-modal-overlay {
      position: fixed;
      inset: 0;
      background: #00000080;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      backdrop-filter: blur(4px);
    }

    .task-modal-overlay.active {
      display: flex;
    }

    .task-modal {
      background: #13131f;
      border: 1px solid #1a1a2e;
      border-radius: 16px;
      width: 520px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .task-modal-header {
      padding: 20px 24px 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .task-modal-header h2 {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
    }

    .task-modal-close {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: none;
      background: none;
      color: #666;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .task-modal-close:hover {
      background: #ffffff0a;
      color: #e0e0e0;
    }

    .task-modal-body {
      padding: 20px 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .task-form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .task-form-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #555;
    }

    .task-form-input {
      background: #0a0a0f;
      border: 1px solid #1a1a2e;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 13px;
      color: #e0e0e0;
      outline: none;
      font-family: inherit;
    }

    .task-form-input:focus {
      border-color: #818cf8;
    }

    .task-form-input::placeholder {
      color: #333;
    }

    .task-form-row {
      display: flex;
      gap: 12px;
    }

    .task-form-row .task-form-group {
      flex: 1;
    }

    .task-form-select {
      background: #0a0a0f;
      border: 1px solid #1a1a2e;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 13px;
      color: #e0e0e0;
      outline: none;
      appearance: none;
      cursor: pointer;
    }

    .task-form-select:focus {
      border-color: #818cf8;
    }

    .task-modal-footer {
      padding: 16px 24px;
      border-top: 1px solid #1a1a2e;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .task-btn-cancel {
      background: none;
      border: 1px solid #1a1a2e;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 12px;
      color: #888;
      cursor: pointer;
    }

    .task-btn-cancel:hover {
      border-color: #333;
      color: #e0e0e0;
    }

    .task-btn-save {
      background: #818cf8;
      border: none;
      border-radius: 8px;
      padding: 8px 20px;
      font-size: 12px;
      font-weight: 500;
      color: white;
      cursor: pointer;
    }

    .task-btn-save:hover {
      background: #6366f1;
    }

    .task-toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .task-toggle {
      width: 36px;
      height: 20px;
      background: #1a1a2e;
      border-radius: 10px;
      position: relative;
      cursor: pointer;
      transition: all 0.2s;
    }

    .task-toggle.on {
      background: #818cf8;
    }

    .task-toggle::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.2s;
    }

    .task-toggle.on::after {
      left: 18px;
    }

    /* Skills Grid */
    .skills-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 16px;
    }

    .skill-card {
      background: #181818;
      border: 1px solid #252525;
      border-radius: 12px;
      padding: 20px;
      transition: border-color 0.2s;
    }

    .skill-card:hover {
      border-color: #333;
    }

    .skill-card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .skill-card-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .skill-icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #252525;
      border-radius: 8px;
      color: #888;
    }

    .skill-icon.active {
      background: linear-gradient(135deg, #1a3d2a 0%, #1a2a3d 100%);
      color: #4ade80;
    }

    .skill-icon svg {
      width: 18px;
      height: 18px;
    }

    .skill-card-title h3 {
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      margin: 0;
    }

    .skill-card-status {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
    }

    .skill-card-status.active {
      background: #1a3d2a;
      color: #4ade80;
    }

    .skill-card-status.available {
      background: #252525;
      color: #888;
    }

    .skill-card-desc {
      font-size: 13px;
      color: #999;
      line-height: 1.5;
      margin-bottom: 16px;
    }

    .skill-card-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }

    .skill-meta-tag {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      background: #1e2a3a;
      color: #7aa2d4;
    }

    .skill-meta-tag.api {
      background: #2a1e3a;
      color: #a585d4;
    }

    .skill-card-usage {
      font-size: 12px;
      color: #666;
      background: #1a1a1a;
      border-radius: 6px;
      padding: 10px 12px;
      font-family: 'SF Mono', Monaco, monospace;
    }

    .skill-card-usage code {
      color: #4ade80;
    }

    /* View Toggle */
    .view-toggle {
      display: flex;
      gap: 4px;
      background: #1a1a1a;
      padding: 4px;
      border-radius: 8px;
    }

    .view-btn {
      background: transparent;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }

    .view-btn:hover {
      color: #999;
    }

    .view-btn.active {
      background: #252525;
      color: #4ade80;
    }

    .view-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Skills List View */
    .skills-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .skill-row {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 16px;
      background: #181818;
      border: 1px solid #252525;
      border-radius: 8px;
      transition: border-color 0.2s;
    }

    .skill-row:hover {
      border-color: #333;
    }

    .skill-row-icon {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #252525;
      border-radius: 6px;
      color: #888;
      flex-shrink: 0;
    }

    .skill-row-icon.active {
      background: linear-gradient(135deg, #1a3d2a 0%, #1a2a3d 100%);
      color: #4ade80;
    }

    .skill-row-icon svg {
      width: 16px;
      height: 16px;
    }

    .skill-row-name {
      font-size: 14px;
      font-weight: 500;
      color: #fff;
      min-width: 140px;
    }

    .skill-row-desc {
      font-size: 13px;
      color: #888;
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .skill-row-tags {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }

    .skill-row-status {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
      flex-shrink: 0;
    }

    .skill-row-status.active {
      background: #1a3d2a;
      color: #4ade80;
    }

    .skill-row-status.available {
      background: #252525;
      color: #888;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-backdrop {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
    }

    .modal-content {
      position: relative;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid #252525;
    }

    .modal-header h3 {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      color: #666;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }

    .modal-close:hover {
      color: #fff;
    }

    .modal-body {
      padding: 20px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-size: 12px;
      color: #888;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-group select,
    .form-group textarea {
      width: 100%;
      background: #252525;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 10px 12px;
      color: #fff;
      font-size: 14px;
      font-family: inherit;
    }

    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #5b9bf5;
    }

    .form-group input[type="range"] {
      width: calc(100% - 50px);
      vertical-align: middle;
    }

    .form-group #editProgressValue {
      display: inline-block;
      width: 40px;
      text-align: right;
      color: #888;
      font-size: 13px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding: 16px 20px;
      border-top: 1px solid #252525;
    }

    .btn-secondary,
    .btn-primary {
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border: none;
    }

    .btn-secondary {
      background: #333;
      color: #999;
    }

    .btn-secondary:hover {
      background: #404040;
    }

    .btn-primary {
      background: #5b9bf5;
      color: #fff;
    }

    .btn-primary:hover {
      background: #4a8be5;
    }

    /* Edit button on project rows */
    .edit-btn {
      background: #252525;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 4px 8px;
      color: #888;
      font-size: 11px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .table tr:hover .edit-btn {
      opacity: 1;
    }

    .edit-btn:hover {
      background: #333;
      color: #fff;
    }
    /* Command Center Widgets */
    .command-center {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .widget {
      background: #161616;
      border: 1px solid #232323;
      border-radius: 8px;
      padding: 16px;
    }

    .widget-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      font-weight: 600;
      font-size: 14px;
    }

    .widget-content {
      font-size: 13px;
      line-height: 1.4;
    }

    .agent-item, .api-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #232323;
    }

    .agent-item:last-child, .api-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .agent-info {
      flex: 1;
    }

    .agent-name {
      font-weight: 500;
      color: #e5e5e5;
    }

    .agent-role, .api-status {
      font-size: 12px;
      color: #888;
      margin-top: 2px;
    }

    .agent-model {
      font-size: 11px;
      background: #1e2a3a;
      color: #7aa2d4;
      padding: 2px 6px;
      border-radius: 3px;
      margin-left: 8px;
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #4ade80;
    }

    .status-indicator.error {
      background: #ef4444;
    }

    .cron-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      text-align: center;
    }

    .cron-stat {
      padding: 8px;
      background: #111111;
      border-radius: 6px;
    }

    .cron-stat-number {
      font-size: 18px;
      font-weight: 600;
      color: #4ade80;
    }

    .cron-stat-label {
      font-size: 11px;
      color: #888;
      margin-top: 4px;
    }

    .api-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
    }

    .api-status-card {
      background: #111111;
      border-radius: 6px;
      padding: 10px;
      text-align: center;
    }

    .api-name {
      font-weight: 500;
      font-size: 12px;
      margin-bottom: 4px;
    }

    .api-cost {
      font-size: 10px;
      color: #888;
    }

    .oura-placeholders {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .oura-metric {
      text-align: center;
      padding: 8px;
      background: #111111;
      border-radius: 6px;
    }

    .oura-value {
      font-size: 16px;
      font-weight: 600;
      color: #888;
    }

    .oura-label {
      font-size: 11px;
      color: #666;
      margin-top: 4px;
    }

    /* Enhanced Cron Jobs Table */
    .agent-badge {
      display: inline-block;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: 500;
      text-transform: uppercase;
    }

    .agent-badge.alfred {
      background: #1e2a3a;
      color: #7aa2d4;
    }

    .agent-badge.sentinel {
      background: #2a1e3a;
      color: #a585d4;
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }

    .status-dot.enabled {
      background: #4ade80;
    }

    .status-dot.disabled {
      background: #ef4444;
    }

    /* Org Chart Styles */
    #orgChartContainer {
      padding: 40px 20px;
      background: #181818;
      border: 1px solid #252525;
      border-radius: 12px;
      overflow-x: auto;
      min-height: 600px;
    }

    .org-tree {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      min-width: 800px;
    }

    .org-node {
      position: relative;
      margin: 20px 0;
    }

    .org-card {
      background: #161616;
      border: 1px solid #232323;
      border-radius: 8px;
      padding: 16px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 280px;
      position: relative;
    }

    .org-card:hover {
      transform: translateY(-2px);
      border-color: #333;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    }

    .org-card.ceo {
      border-color: #fbbf24;
      background: linear-gradient(135deg, #1a1a0a 0%, #2a2a1a 100%);
    }

    .org-card.active {
      border-color: #4ade80;
      background: linear-gradient(135deg, #0a1a0a 0%, #1a2a1a 100%);
    }

    .org-card.active::before {
      content: '';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 8px;
      height: 8px;
      background: #4ade80;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .org-card.planned {
      border: 2px dashed #fbbf24;
      background: linear-gradient(135deg, #1a1a0a 0%, #2a2a1a 100%);
      opacity: 0.8;
    }

    .org-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .org-icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      color: #888;
    }

    .org-card.ceo .org-icon {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #1a1a1a;
    }

    .org-card.active .org-icon {
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      color: #1a1a1a;
    }

    .org-card.planned .org-icon {
      background: #252525;
      color: #fbbf24;
    }

    .org-icon svg {
      width: 18px;
      height: 18px;
    }

    .org-name {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      flex: 1;
    }

    .org-title {
      font-size: 14px;
      color: #888;
      margin-top: 2px;
    }

    .org-status {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
    }

    .org-status.active {
      background: #1a3d2a;
      color: #4ade80;
    }

    .org-status.planned {
      background: #2a1a1a;
      color: #fbbf24;
    }

    .org-model {
      font-size: 10px;
      background: #1e2a3a;
      color: #7aa2d4;
      padding: 2px 6px;
      border-radius: 3px;
      margin-left: 8px;
    }

    .org-details {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #232323;
    }

    .org-card.expanded .org-details {
      max-height: 300px;
    }

    .org-detail-row {
      display: flex;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .org-detail-label {
      width: 80px;
      color: #666;
      flex-shrink: 0;
    }

    .org-detail-value {
      color: #bbb;
      flex: 1;
    }

    .org-crons {
      color: #4ade80;
      font-weight: 500;
    }

    .org-children {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 40px;
      margin-top: 40px;
      position: relative;
    }

    .org-children::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 20px;
      background: #333;
    }

    .org-children .org-card::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 20px;
      background: #333;
    }

    .org-children::after {
      content: '';
      position: absolute;
      top: -20px;
      left: 0;
      right: 0;
      height: 2px;
      background: #333;
    }

    .hire-btn {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: #fbbf24;
      color: #1a1a1a;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .hire-btn:hover {
      background: #f59e0b;
      transform: scale(1.05);
    }

    .hire-tooltip {
      position: absolute;
      bottom: 35px;
      right: 0;
      background: #1a1a1a;
      color: #ccc;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 11px;
      border: 1px solid #333;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .hire-btn:hover .hire-tooltip {
      opacity: 1;
    }

    /* Mobile responsive for org chart */
    @media (max-width: 768px) {
      #orgChartContainer {
        padding: 20px 10px;
      }

      .org-tree {
        min-width: auto;
      }

      .org-children {
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      .org-card {
        min-width: 260px;
      }

      .org-children::after {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1><i data-lucide="rocket" style="width:26px;height:26px;vertical-align:-5px;margin-right:10px;"></i>Mission Control <span style="font-size:12px;color:#4ade80;font-weight:400;vertical-align:middle;">v4.0.0</span></h1>
    </div>

    <div class="sidebar-nav">
      <nav class="nav-section">
        <div class="nav-label">Overview</div>
        <div class="nav-item active" data-filter="all">
          <i data-lucide="layout-grid"></i> All Items
          <span class="count" id="navAll">0</span>
        </div>
        <div class="nav-item" data-filter="tasks">
          <i data-lucide="check-square"></i> Tasks
          <span class="count" id="navTasks">0</span>
        </div>
        <div class="nav-item" data-filter="projects">
          <i data-lucide="folder-kanban"></i> Projects
          <span class="count" id="navProjects">0</span>
        </div>
        <div class="nav-item" data-filter="active">
          <i data-lucide="play-circle"></i> Active
          <span class="count" id="navActive">0</span>
        </div>
        <div class="nav-item" data-filter="queue">
          <i data-lucide="list"></i> Queue
          <span class="count" id="navQueue">0</span>
        </div>
      </nav>

      <nav class="nav-section">
        <div class="nav-label">Status</div>
        <div class="nav-item" data-filter="done">
          <i data-lucide="check-circle"></i> Completed
          <span class="count" id="navDone">0</span>
        </div>
        <div class="nav-item" data-filter="archived">
          <i data-lucide="archive"></i> Archived
          <span class="count">0</span>
        </div>
      </nav>

      <nav class="nav-section">
        <div class="nav-label">History</div>
        <div class="nav-item" data-filter="daily-logs">
          <i data-lucide="calendar"></i> Daily Logs
          <span class="count" id="navDailyLogs">0</span>
        </div>
        <div class="nav-item" data-filter="notes">
          <i data-lucide="notebook-pen"></i> Notes
          <span class="count" id="navNotes">0</span>
        </div>
      </nav>

      <nav class="nav-section">
        <div class="nav-label">Projects</div>
        <div class="nav-item" data-filter="projects-hub">
          <i data-lucide="folder-kanban"></i> Projects Hub
          <span class="count" id="navProjectsHub">19</span>
        </div>
      </nav>

      <nav class="nav-section">
        <div class="nav-label">Capabilities</div>
        <div class="nav-item" data-filter="skills">
          <i data-lucide="puzzle"></i> Skills
          <span class="count" id="navSkills">0</span>
        </div>
      </nav>

      <nav class="nav-section">
        <div class="nav-label">System</div>
        <div class="nav-item" data-filter="tools">
          <i data-lucide="wrench"></i> Tools & APIs
          <span class="count" id="navTools">0</span>
        </div>
        <div class="nav-item" data-filter="crons">
          <i data-lucide="clock"></i> Cron Jobs
          <span class="count" id="navCrons">0</span>
        </div>
        <div class="nav-item" data-filter="files">
          <i data-lucide="file-text"></i> Core Files
          <span class="count" id="navFiles">0</span>
        </div>
        <div class="nav-item" data-filter="docs">
          <i data-lucide="book-open"></i> Docs
          <span class="count" id="navDocs">0</span>
        </div>
        <div class="nav-item" data-filter="org-chart">
          <i data-lucide="network"></i> Org Chart
          <span class="count">5</span>
        </div>
      </nav>
    </div>

    <div class="sidebar-footer">
      <div style="margin-bottom: 8px; color: #4ade80; font-weight: 500;">v4.0.0</div>
      Last updated<br>
      <span id="lastUpdated">-</span>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <div class="page-header">
      <div class="page-header-main">
        <div>
          <h2 id="pageTitle">All Items</h2>
          <p id="pageDate"></p>
        </div>
        <div class="tz-indicator" id="tzIndicator">
          <span class="tz-time" id="localTimeNow">--:--</span>
          <span class="tz-label" id="locationCity">HKT</span>
        </div>
      </div>
    </div>

    <!-- Search Box -->
    <div class="search-box">
      <i data-lucide="search"></i>
      <input type="text" id="searchInput" placeholder="Search projects, tasks, ideas..." oninput="handleSearch(this.value)" onfocus="showSearchResults()" onblur="setTimeout(hideSearchResults, 200)">
      <div class="search-results" id="searchResults"></div>
    </div>

    <!-- Current task banner + stats removed for cleaner look -->

    <!-- Command Center Widgets (v3.1.0) -->
    <div class="command-center" id="commandCenter">
      <!-- Agent Status Widget -->
      <div class="widget">
        <div class="widget-header">
          <i data-lucide="bot"></i>
          Agent Status
        </div>
        <div class="widget-content" id="agentStatus">
          <!-- Populated by JavaScript -->
        </div>
      </div>

      <!-- Cron Health Widget -->
      <div class="widget">
        <div class="widget-header">
          <i data-lucide="zap"></i>
          Cron Health
        </div>
        <div class="widget-content">
          <div class="cron-stats" id="cronStats">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>

      <!-- API Health Widget -->
      <div class="widget">
        <div class="widget-header">
          <i data-lucide="radio"></i>
          API Health
        </div>
        <div class="widget-content">
          <div class="api-grid" id="apiGrid">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Oura Widget -->
      <div class="widget">
        <div class="widget-header">
          <i data-lucide="moon"></i>
          Oura Health
        </div>
        <div class="widget-content">
          <div class="oura-placeholders">
            <div class="oura-metric">
              <div class="oura-value">--</div>
              <div class="oura-label">Sleep</div>
            </div>
            <div class="oura-metric">
              <div class="oura-value">--</div>
              <div class="oura-label">Readiness</div>
            </div>
            <div class="oura-metric">
              <div class="oura-value">--</div>
              <div class="oura-label">HRV</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Projects Section -->
    <section class="section" id="projectsSection">
      <div class="section-header">
        <span class="section-title"><i data-lucide="folder-kanban"></i> Projects</span>
      </div>
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th style="width: 40%">Project</th>
              <th>Status</th>
              <th>Progress</th>
              <th>Updated</th>
            </tr>
          </thead>
          <tbody id="projectsTable"></tbody>
        </table>
      </div>
    </section>

    <!-- Tasks Section -->
    <section class="section" id="tasksSection">
      <div class="section-header">
        <span class="section-title"><i data-lucide="check-square"></i> Tasks</span>
      </div>
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th style="width: 50%">Task</th>
              <th>Status</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="tasksTable"></tbody>
        </table>
      </div>
    </section>

    <!-- Ideas Section -->
    <section class="section" id="ideasSection">
      <div class="section-header">
        <span class="section-title"><i data-lucide="lightbulb"></i> Ideas & Suggestions</span>
      </div>
      <div class="ideas-list" id="ideasList"></div>
    </section>

    <!-- Recent Activity -->
    <section class="section" id="activitySection">
      <div class="section-header">
        <span class="section-title"><i data-lucide="activity"></i> Recent Activity</span>
      </div>
      <div class="activity-list" id="activityList"></div>
    </section>

    <!-- Tools Section -->
    <section class="section" id="toolsSection" style="display: none;">
      <div class="section-header">
        <span class="section-title"><i data-lucide="plug"></i> APIs & Integrations</span>
      </div>
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th style="width: 20%">API</th>
              <th>Description</th>
              <th style="width: 10%">Cost</th>
              <th style="width: 12%">Last Used</th>
              <th style="width: 10%">Status</th>
            </tr>
          </thead>
          <tbody id="toolsTable"></tbody>
        </table>
      </div>
    </section>

    <!-- Crons Section -->
    <section class="section" id="cronsSection" style="display: none;">
      <div class="section-header" style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
        <span class="section-title"><i data-lucide="clock"></i> Scheduled Jobs <span id="cronCount" style="color:#666;font-size:14px;font-weight:400;"></span></span>
        <div id="cronFilters" style="display:flex;gap:6px;">
          <button class="cron-filter-btn active" data-agent="all" style="padding:4px 12px;border-radius:6px;border:1px solid #333;background:#232323;color:#ccc;cursor:pointer;font-size:12px;transition:all .2s;">All</button>
          <button class="cron-filter-btn" data-agent="alfred" style="padding:4px 12px;border-radius:6px;border:1px solid #1a3a5c;background:transparent;color:#8bf;cursor:pointer;font-size:12px;transition:all .2s;">ðŸ¤– Alfred</button>
          <button class="cron-filter-btn" data-agent="sentinel" style="padding:4px 12px;border-radius:6px;border:1px solid #3a1a5c;background:transparent;color:#c8f;cursor:pointer;font-size:12px;transition:all .2s;">ðŸŽ¯ Sentinel</button>
          <button class="cron-filter-btn" data-agent="system" style="padding:4px 12px;border-radius:6px;border:1px solid #333;background:transparent;color:#888;cursor:pointer;font-size:12px;transition:all .2s;">âš™ï¸ System</button>
        </div>
      </div>
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th style="width: 18%">Job</th>
              <th>Description</th>
              <th style="width: 12%">Schedule</th>
              <th style="width: 8%">Agent</th>
              <th style="width: 10%">Model</th>
              <th style="width: 8%">Status</th>
            </tr>
          </thead>
          <tbody id="cronsTable"></tbody>
        </table>
      </div>
    </section>

    <!-- Files Section -->
    <section class="section" id="filesSection" style="display: none;">
      <div class="section-header">
        <span class="section-title"><i data-lucide="file-text"></i> Core Files</span>
      </div>
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th style="width: 20%">File</th>
              <th>Description</th>
              <th style="width: 15%">Category</th>
            </tr>
          </thead>
          <tbody id="filesTable"></tbody>
        </table>
      </div>
      <div id="fileViewer" style="display: none; margin-top: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h3 id="fileViewerTitle" style="color: #fff; font-size: 18px;"></h3>
          <button onclick="closeFileViewer()" style="background: #333; border: none; color: #999; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Close</button>
        </div>
        <pre id="fileContent" style="background: #1a1a1a; border: 1px solid #252525; border-radius: 8px; padding: 20px; color: #ccc; font-size: 14px; line-height: 1.6; overflow-x: auto; white-space: pre-wrap; max-height: 600px; overflow-y: auto;"></pre>
      </div>
    </section>

    <!-- Daily Logs Section -->
    <section class="section" id="dailyLogsSection" style="display: none;">
      <div class="section-header">
        <span class="section-title"><i data-lucide="calendar"></i> Daily Logs</span>
      </div>
      <div class="daily-logs-container">
        <div class="daily-logs-sidebar" id="dailyLogsList"></div>
        <div class="daily-logs-content">
          <div class="daily-log-header" id="dailyLogHeader">
            <span class="daily-log-date">Select a day</span>
          </div>
          <div class="daily-log-body" id="dailyLogBody">
            <p style="color: #666; padding: 40px; text-align: center;">â† Choose a date from the list to view that day's log</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Notes Section -->
    <section class="section" id="notesSection" style="display: none;">
      <div class="section-header">
        <span class="section-title"><i data-lucide="notebook-pen"></i> Notes</span>
      </div>
      <div style="margin-bottom: 16px;">
        <div id="notesTabBar" style="display: flex; gap: 4px; background: #1a1a1a; padding: 4px; border-radius: 8px; width: fit-content;">
          <button class="notes-tab-btn active" data-tab="general" style="padding: 6px 12px; border-radius: 6px; border: none; background: #232323; color: #ccc; cursor: pointer; font-size: 12px; transition: all .2s; display: flex; align-items: center; gap: 6px;">ðŸ“ General</button>
          <button class="notes-tab-btn" data-tab="trading" style="padding: 6px 12px; border-radius: 6px; border: none; background: transparent; color: #888; cursor: pointer; font-size: 12px; transition: all .2s; display: flex; align-items: center; gap: 6px;">ðŸ“ˆ Trading</button>
          <button class="notes-tab-btn" data-tab="reminders" style="padding: 6px 12px; border-radius: 6px; border: none; background: transparent; color: #888; cursor: pointer; font-size: 12px; transition: all .2s; display: flex; align-items: center; gap: 6px;">â° Reminders</button>
          <button class="notes-tab-btn" data-tab="ideas" style="padding: 6px 12px; border-radius: 6px; border: none; background: transparent; color: #888; cursor: pointer; font-size: 12px; transition: all .2s; display: flex; align-items: center; gap: 6px;">ðŸ’¡ Ideas</button>
        </div>
      </div>
      <div class="daily-logs-container">
        <div class="daily-logs-sidebar" id="notesList"></div>
        <div class="daily-logs-content">
          <div class="daily-log-header" id="notesHeader">
            <span class="daily-log-date">Select an item</span>
          </div>
          <div class="daily-log-body" id="notesBody">
            <p style="color: #666; padding: 40px; text-align: center;">â† Choose an item to view content</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Tasks Full Section (standalone page) -->
    <section class="section" id="tasksFullSection" style="display: none;">
      <div class="section-header">
        <span class="section-title"><i data-lucide="check-square"></i> Tasks</span>
      </div>
      
      <!-- Stats Bar -->
      <div class="tasks-stats-bar" id="tasksStatsBar">
        <div class="tasks-stat"><span class="tasks-stat-value" id="tasksStatActive">0</span><span class="tasks-stat-label">Active</span></div>
        <div class="tasks-stat"><span class="tasks-stat-value" id="tasksStatDueToday">0</span><span class="tasks-stat-label">Due Today</span></div>
        <div class="tasks-stat"><span class="tasks-stat-value" id="tasksStatThisWeek">0</span><span class="tasks-stat-label">This Week</span></div>
        <div class="tasks-stat"><span class="tasks-stat-value" id="tasksStatCompleted">0</span><span class="tasks-stat-label">Completed</span></div>
      </div>
      
      <!-- Upcoming Reminders Strip -->
      <div class="tasks-reminders-strip" id="tasksRemindersStrip" style="display: none;">
        <div class="tasks-reminders-strip-header">
          <i data-lucide="bell" style="width: 12px; height: 12px;"></i>
          Upcoming Reminders
        </div>
        <div id="tasksRemindersList"></div>
      </div>
      
      <!-- Toolbar -->
      <div class="tasks-toolbar">
        <div class="tasks-filter-tabs">
          <button class="tasks-filter-tab active" data-filter="all"><span class="dot all"></span>All</button>
          <button class="tasks-filter-tab" data-filter="personal"><span class="dot personal"></span>Personal</button>
          <button class="tasks-filter-tab" data-filter="project"><span class="dot project"></span>Project</button>
          <button class="tasks-filter-tab" data-filter="reminders"><span class="dot reminder"></span>Reminders</button>
        </div>
        <div class="tasks-toolbar-right">
          <input type="text" class="tasks-search-box" id="tasksSearchInput" placeholder="Search tasks...">
          <button class="tasks-btn-add" onclick="openTaskModal()">
            <i data-lucide="plus" style="width: 14px; height: 14px;"></i>
            New Task
          </button>
        </div>
      </div>
      
      <!-- Task Groups Container -->
      <div id="tasksGroupsContainer">
        <div class="todo-empty">Loading tasks...</div>
      </div>
    </section>
    
    <!-- Task Modal -->
    <div class="task-modal-overlay" id="taskModalOverlay">
      <div class="task-modal">
        <div class="task-modal-header">
          <h2 id="taskModalTitle">New Task</h2>
          <button class="task-modal-close" onclick="closeTaskModal()">âœ•</button>
        </div>
        <div class="task-modal-body">
          <input type="hidden" id="taskEditId">
          <div class="task-form-group">
            <label class="task-form-label">Title</label>
            <input class="task-form-input" id="taskFormTitle" placeholder="What needs to be done?">
          </div>
          <div class="task-form-group">
            <label class="task-form-label">Description</label>
            <textarea class="task-form-input" id="taskFormDesc" rows="2" placeholder="Optional details..."></textarea>
          </div>
          <div class="task-form-row">
            <div class="task-form-group">
              <label class="task-form-label">Type</label>
              <select class="task-form-select" id="taskFormType">
                <option value="personal">Personal</option>
                <option value="project">Project Task</option>
              </select>
            </div>
            <div class="task-form-group">
              <label class="task-form-label">Priority</label>
              <select class="task-form-select" id="taskFormPriority">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
              </select>
            </div>
          </div>
          <div class="task-form-row">
            <div class="task-form-group">
              <label class="task-form-label">Project</label>
              <select class="task-form-select" id="taskFormProject">
                <option value="">None (Personal)</option>
              </select>
            </div>
            <div class="task-form-group">
              <label class="task-form-label">Assign To</label>
              <select class="task-form-select" id="taskFormAssignee">
                <option value="">Unassigned</option>
                <option value="nam">Nam</option>
                <option value="alfred">Alfred</option>
                <option value="sentinel">Sentinel</option>
              </select>
            </div>
          </div>
          <div class="task-form-row">
            <div class="task-form-group">
              <label class="task-form-label">Due Date</label>
              <input class="task-form-input" type="date" id="taskFormDueDate">
            </div>
            <div class="task-form-group">
              <label class="task-form-label">Category</label>
              <select class="task-form-select" id="taskFormCategory">
                <option value="">None</option>
                <option value="finance">Finance</option>
                <option value="health">Health</option>
                <option value="travel">Travel</option>
                <option value="family">Family</option>
                <option value="work">Work</option>
              </select>
            </div>
          </div>
          <div class="task-form-group">
            <div class="task-toggle-row">
              <div>
                <label class="task-form-label" style="margin-bottom: 2px;">Reminder</label>
                <div style="font-size: 11px; color: #444;">Get pinged on Discord/Telegram</div>
              </div>
              <div class="task-toggle" id="taskFormReminderToggle" onclick="this.classList.toggle('on'); toggleReminderFields()"></div>
            </div>
          </div>
          <div class="task-form-row" id="taskReminderFields" style="display: none;">
            <div class="task-form-group">
              <label class="task-form-label">Remind At</label>
              <input class="task-form-input" type="datetime-local" id="taskFormReminderAt">
            </div>
            <div class="task-form-group">
              <label class="task-form-label">Repeat</label>
              <select class="task-form-select" id="taskFormReminderRepeat">
                <option value="never">Never</option>
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
              </select>
            </div>
          </div>
        </div>
        <div class="task-modal-footer">
          <button class="task-btn-cancel" onclick="closeTaskModal()">Cancel</button>
          <button class="task-btn-save" onclick="saveTask()">Create Task</button>
        </div>
      </div>
    </div>

    <!-- Projects Section -->
    <section class="section" id="projectsHubSection" style="display: none;">
      <!-- Projects List View -->
      <div id="projectsListView">
        <div class="section-header" style="margin-bottom: 20px;">
          <span class="section-title"><i data-lucide="folder-kanban"></i> Projects</span>
        </div>
        
        <!-- Filters -->
        <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap;">
          <select id="projectStatusFilter" style="background: #1a1a1a; border: 1px solid #2a2a2a; color: #ccc; padding: 8px 12px; border-radius: 6px; font-size: 13px; cursor: pointer;">
            <option value="">All Statuses</option>
            <option value="live">âœ… Live</option>
            <option value="building">ðŸš§ Building</option>
            <option value="planning">ðŸ“ Planning</option>
            <option value="research">ðŸ”¬ Research</option>
            <option value="paused">â¸ï¸ Paused</option>
            <option value="archived">ðŸ“¦ Archived</option>
          </select>
          
          <select id="projectTagFilter" style="background: #1a1a1a; border: 1px solid #2a2a2a; color: #ccc; padding: 8px 12px; border-radius: 6px; font-size: 13px; cursor: pointer;">
            <option value="">All Tags</option>
          </select>
          
          <input type="text" id="projectSearchInput" placeholder="Search projects..." style="flex: 1; min-width: 200px; background: #1a1a1a; border: 1px solid #2a2a2a; color: #ccc; padding: 8px 12px; border-radius: 6px; font-size: 13px;">
        </div>
        
        <!-- Projects Grid -->
        <div id="projectsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px;"></div>
      </div>
      
      <!-- Project Detail View -->
      <div id="projectDetailView" style="display: none;">
        <div style="margin-bottom: 20px;">
          <button id="backToProjectsList" style="background: #1a1a1a; border: 1px solid #2a2a2a; color: #999; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 6px;">
            <i data-lucide="arrow-left" style="width: 14px; height: 14px;"></i> Back to Projects
          </button>
        </div>
        
        <div id="projectDetailContent"></div>
      </div>
    </section>

    <!-- Skills Section -->
    <section class="section" id="skillsSection" style="display: none;">
      <div class="section-header">
        <span class="section-title"><i data-lucide="puzzle"></i> Installed Skills</span>
        <div class="view-toggle">
          <button class="view-btn active" id="gridViewBtn" onclick="setSkillsView('grid')"><i data-lucide="layout-grid"></i></button>
          <button class="view-btn" id="listViewBtn" onclick="setSkillsView('list')"><i data-lucide="list"></i></button>
        </div>
      </div>
      <div class="skills-grid" id="activeSkillsGrid"></div>
      <div class="skills-list" id="activeSkillsList" style="display: none;"></div>
      
      <div class="section-header" style="margin-top: 32px;">
        <span class="section-title"><i data-lucide="package"></i> Available Skills</span>
      </div>
      <div class="skills-grid" id="availableSkillsGrid"></div>
      <div class="skills-list" id="availableSkillsList" style="display: none;"></div>
    </section>

    <!-- Docs Section -->
    <section class="section" id="docsSection" style="display: none;">
      <div class="section-header">
        <span class="section-title"><i data-lucide="book-open"></i> Documents</span>
      </div>
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th style="width: 25%">Document</th>
              <th>Description</th>
              <th style="width: 15%">Category</th>
              <th style="width: 12%">Updated</th>
            </tr>
          </thead>
          <tbody id="docsTable"></tbody>
        </table>
      </div>
      <div id="docViewer" style="display: none; margin-top: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #252525;">
          <h3 id="docViewerTitle" style="color: #fff; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px;"><span style="color: #4ade80;">ðŸ“„</span></h3>
          <button onclick="closeDocViewer()" style="background: #252525; border: 1px solid #333; color: #999; padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.15s;" onmouseover="this.style.background='#333';this.style.color='#fff'" onmouseout="this.style.background='#252525';this.style.color='#999'">Close</button>
        </div>
        <div id="docContent" style="background: #161616; border: 1px solid #252525; border-radius: 10px; padding: 28px 32px; color: #b5b5b5; font-size: 14px; line-height: 1.65; overflow-x: auto; max-height: 70vh; overflow-y: auto;"></div>
      </div>
    </section>

    <!-- Org Chart Section -->
    <section class="section" id="orgChartSection" style="display: none;">
      <div class="section-header">
        <span class="section-title"><i data-lucide="network"></i> Organization Chart</span>
      </div>
      <div id="orgChartContainer">
        <!-- Org chart will be rendered here -->
      </div>
    </section>
  </main>

  <!-- Edit Modal -->
  <div id="editModal" class="modal" style="display: none;">
    <div class="modal-backdrop" onclick="closeEditModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="editModalTitle">Edit Project</h3>
        <button class="modal-close" onclick="closeEditModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Status</label>
          <select id="editStatus">
            <option value="active">ðŸ”„ Active</option>
            <option value="queue">ðŸ“‹ Queue</option>
            <option value="done">âœ… Complete</option>
            <option value="archived">ðŸ“¦ Archived</option>
          </select>
        </div>
        <div class="form-group">
          <label>Progress</label>
          <input type="range" id="editProgress" min="0" max="100" value="0">
          <span id="editProgressValue">0%</span>
        </div>
        <div class="form-group">
          <label>Notes</label>
          <textarea id="editNotes" rows="3" placeholder="Add notes..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeEditModal()">Cancel</button>
        <button class="btn-primary" onclick="saveEdit()">Save Changes</button>
      </div>
    </div>
  </div>

  <script>
    let data = null;
    let currentFilter = 'all';
    
    // Convex client setup
    const CONVEX_URL = "https://mild-fly-339.convex.cloud";
    const convexClient = new convex.ConvexHttpClient(CONVEX_URL);

    async function loadData() {
      try {
        // Fetch from Convex
        const dashboardData = await convexClient.query("dashboard:getData");
        
        // Transform Convex data to match existing format
        const items = [];
        
        // Add projects
        dashboardData.projects.all.forEach(p => {
          items.push({
            id: p._id,
            type: 'project',
            title: p.title,
            description: p.description,
            status: p.status,
            progress: p.progress,
            liveUrl: p.liveUrl,
            repoUrl: p.repoUrl,
            links: { live: p.liveUrl, repo: p.repoUrl },
            created: new Date(p.createdAt).toISOString(),
            updated: new Date(p.updatedAt).toISOString(),
          });
        });
        
        // Add todos as tasks
        dashboardData.todos.active.forEach(t => {
          items.push({
            id: t._id,
            type: 'task',
            title: t.title,
            description: t.description,
            status: 'active',
            created: new Date(t.createdAt).toISOString(),
          });
        });
        
        dashboardData.todos.completed.forEach(t => {
          items.push({
            id: t._id,
            type: 'task',
            title: t.title,
            description: t.description,
            status: 'done',
            created: new Date(t.createdAt).toISOString(),
            completed: t.completedAt ? new Date(t.completedAt).toISOString() : null,
          });
        });
        
        // Add ideas
        dashboardData.ideas.all.forEach(i => {
          items.push({
            id: i._id,
            type: 'idea',
            title: i.title,
            description: i.description,
            status: 'idea',
            created: new Date(i.createdAt).toISOString(),
          });
        });
        
        // Build data object matching old format
        const activityMapped = dashboardData.activity.map(a => ({
          time: new Date(a.timestamp).toISOString(),
          text: a.text,
          action: a.text // render uses 'action' field
        }));
        
        // Tools from Convex - transform to match frontend format
        const tools = dashboardData.tools.all.map(t => ({
          name: t.name,
          type: t.type,
          category: t.category,
          description: t.description,
          status: t.status,
          icon: t.icon || 'ðŸ”§',
          auth: t.accessMethod,
          capabilities: t.capabilities || [],
          url: t.url,
          notes: t.notes,
        }));
        
        // Load crons from activity.json (has agent, model, desc)
        let crons = [];
        try {
          const cronResp = await fetch('activity.json?' + Date.now());
          const actJson = await cronResp.json();
          crons = actJson.crons || [];
        } catch(e) { console.warn('Could not load crons from activity.json'); }
        
        data = {
          items,
          todos: dashboardData.todos.active,
          activity: activityMapped,
          recentActivity: activityMapped, // render() expects this
          namLocation: { city: "Dubai", timezone: "GST (UTC+4)" },
          stats: { ...dashboardData.stats, tools: dashboardData.tools.total },
          tools: tools,
          toolsByCategory: dashboardData.tools.byCategory,
          toolsByType: dashboardData.tools.byType,
          apis: tools, // backwards compat
          crons: crons,
        };
        
        render();
        console.log('âœ“ Loaded from Convex:', dashboardData.stats);
      } catch (e) {
        console.error('Convex failed, falling back to JSON:', e);
        // Fallback to static JSON
        try {
          const response = await fetch('activity.json?' + Date.now());
          data = await response.json();
          render();
        } catch (e2) {
          console.error('Failed to load:', e2);
        }
      }
    }

    function formatTime(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const now = new Date();
      const diff = Math.floor((now - date) / 1000 / 60 / 60 / 24);
      
      if (diff === 0) return 'Today';
      if (diff === 1) return 'Yesterday';
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    function timeAgo(dateStr) {
      const now = new Date();
      const date = new Date(dateStr);
      const diff = Math.floor((now - date) / 1000 / 60);
      
      if (diff < 1) return 'Now';
      if (diff < 60) return diff + 'm ago';
      if (diff < 1440) return Math.floor(diff / 60) + 'h ago';
      return Math.floor(diff / 1440) + 'd ago';
    }

    // Command Center Widget Rendering Functions
    function renderAgentStatus() {
      if (!data.agents) return;
      
      const agentStatusEl = document.getElementById('agentStatus');
      agentStatusEl.innerHTML = data.agents.map(agent => `
        <div class="agent-item">
          <div class="agent-info">
            <div class="agent-name">${agent.name}<span class="agent-model">${agent.model}</span></div>
            <div class="agent-role">${agent.role}</div>
          </div>
          <div class="status-indicator"></div>
        </div>
      `).join('');
    }

    function renderCronTable(crons) {
      document.getElementById('cronCount').textContent = `(${crons.length})`;
      document.getElementById('cronsTable').innerHTML = crons.map(cron => {
        const agentBadge = `<span class="agent-badge ${cron.agent || 'alfred'}">${cron.agent || 'alfred'}</span>`;
        const statusDot = `<span class="status-dot ${cron.enabled !== false ? 'enabled' : 'disabled'}"></span>`;
        const enabledText = cron.enabled !== false ? 'Enabled' : 'Disabled';
        
        let modelLabel = cron.model || 'system';
        let modelBg, modelColor;
        if (modelLabel === 'system' || modelLabel === 'â€”') {
          modelBg = '#1a1a1a'; modelColor = '#666';
        } else if (modelLabel.includes('haiku')) {
          modelBg = '#1a2a1a'; modelColor = '#6b8'; modelLabel = 'Haiku';
        } else if (modelLabel.includes('sonnet')) {
          modelBg = '#1a1a2a'; modelColor = '#8bf'; modelLabel = 'Sonnet 4.5';
        } else {
          modelBg = '#2a1a1a'; modelColor = '#f8a'; 
        }
        const modelBadge = `<span style="font-size:11px;padding:2px 8px;border-radius:4px;background:${modelBg};color:${modelColor}">${modelLabel}</span>`;
        
        return `
          <tr>
            <td><div class="title" style="font-size:13px;">${cron.name}</div></td>
            <td style="color: #999; font-size: 12px; line-height: 1.4;">${cron.desc || ''}</td>
            <td style="color: #888; font-family: 'SF Mono', monospace; font-size: 11px;">${cron.schedule}</td>
            <td>${agentBadge}</td>
            <td>${modelBadge}</td>
            <td style="font-size: 12px;">${statusDot}${enabledText}</td>
          </tr>
        `;
      }).join('');
    }

    function renderCronStats() {
      if (!data.crons) return;
      
      const totalJobs = data.crons.length;
      const enabledJobs = data.crons.filter(c => c.enabled).length;
      const healthyJobs = data.crons.filter(c => c.enabled && c.status !== 'error').length;
      const errorJobs = enabledJobs - healthyJobs;
      
      const cronStatsEl = document.getElementById('cronStats');
      cronStatsEl.innerHTML = `
        <div class="cron-stat">
          <div class="cron-stat-number">${totalJobs}</div>
          <div class="cron-stat-label">Total</div>
        </div>
        <div class="cron-stat">
          <div class="cron-stat-number">${healthyJobs}</div>
          <div class="cron-stat-label">Healthy</div>
        </div>
        <div class="cron-stat">
          <div class="cron-stat-number" style="color: ${errorJobs > 0 ? '#ef4444' : '#4ade80'}">${errorJobs}</div>
          <div class="cron-stat-label">Errors</div>
        </div>
      `;
    }

    function renderApiGrid() {
      if (!data.apis) return;
      
      const apiGridEl = document.getElementById('apiGrid');
      apiGridEl.innerHTML = data.apis.map(api => `
        <div class="api-status-card">
          <div class="api-name">${api.name}</div>
          <div class="status-indicator ${api.status === 'active' ? '' : 'error'}"></div>
          <div class="api-cost">${api.cost}</div>
        </div>
      `).join('');
    }

    function renderCommandCenter() {
      // Only show Command Center on "All Items" view
      const commandCenterEl = document.getElementById('commandCenter');
      if (currentFilter === 'all') {
        commandCenterEl.style.display = 'grid';
        renderAgentStatus();
        renderCronStats();
        renderApiGrid();
      } else {
        commandCenterEl.style.display = 'none';
      }
    }

    function render() {
      // Page date
      document.getElementById('pageDate').textContent = 
        new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });

      // Render Command Center widgets
      renderCommandCenter();

      // Current task banner removed

      // Stats
      const active = data.items.filter(i => i.status === 'active').length;
      const queue = data.items.filter(i => i.status === 'queue').length;
      const done = data.items.filter(i => i.status === 'done').length;
      const ideas = data.items.filter(i => i.status === 'idea').length;

      // Stat boxes removed - counts shown in sidebar only
      
      // Timezone indicator (small, top right)
      if (data.namLocation) {
        document.getElementById('locationCity').textContent = data.namLocation.timezone.split(' ')[0]; // Just "HKT" not "(UTC+8)"
        updateLocalTime(data.namLocation.timezone);
      }

      // Nav counts
      document.getElementById('navAll').textContent = data.items.length;
      document.getElementById('navActive').textContent = active;
      document.getElementById('navQueue').textContent = queue;
      document.getElementById('navDone').textContent = done;
      
      // Notes count: trading notes + general notes + reminders + ideas
      let notesCount = 0;
      if (data.crons) notesCount += data.crons.filter(c => ['jessica-hotel-reminder', 'estimize-trial-reminder', 'estimize-cancel-reminder', 'xapi-cancel-reminder', 'ortex-cancel-reminder', 'amzn-buy-reminder', 'duol-earnings-decision', 'flight-cancel-check', 'schwab-re-auth-reminder', 'subscription-review-monthly'].includes(c.name)).length;
      notesCount += ideas; // Ideas count
      // Add general notes and trading notes counts when available
      document.getElementById('navNotes').textContent = notesCount;

      // Filter items
      let items = data.items;
      if (currentFilter !== 'all') {
        items = items.filter(i => i.status === currentFilter);
      }

      // Projects table (type === 'project')
      const projectItems = items.filter(i => i.type === 'project' && i.status !== 'idea');
      document.getElementById('projectsTable').innerHTML = projectItems.map(item => {
        const statusClass = item.blocked ? 'blocked' : item.status;
        const statusLabels = { active: 'Active', done: 'Done', live: 'âœ… Live', building: 'ðŸš§ Building', research: 'ðŸ”¬ Research', planning: 'ðŸ“ Planning', paused: 'â¸ï¸ Paused', archived: 'ðŸ“¦ Archived' };
        const statusLabel = item.blocked ? 'Blocked' : (statusLabels[item.status] || item.status || 'Ready');
        
        const subtasksHtml = item.subtasks ? item.subtasks.map(st => `
          <div class="subtask ${st.done ? 'done' : ''}">
            <span class="subtask-check">${st.done ? 'â˜‘' : 'â˜'}</span>
            <span>${st.title}</span>
          </div>
        `).join('') : '';
        
        const linksHtml = `
          ${item.liveUrl ? `<a href="${item.liveUrl}" target="_blank" onclick="event.stopPropagation()" style="display: inline-flex; align-items: center; gap: 4px; background: #1a3d2a; color: #4ade80; padding: 3px 8px; border-radius: 4px; font-size: 11px; text-decoration: none; margin-left: 8px;">â–² Live</a>` : ''}
          ${item.repoUrl ? `<a href="${item.repoUrl}" target="_blank" onclick="event.stopPropagation()" style="display: inline-flex; align-items: center; gap: 4px; background: #2a2a3d; color: #8b8bf5; padding: 3px 8px; border-radius: 4px; font-size: 11px; text-decoration: none; margin-left: 4px;">âŒ¥ Repo</a>` : ''}
        `;
        
        return `
          <tr class="clickable" data-id="${item.id}">
            <td>
              <div class="title">
                <i data-lucide="chevron-right" class="chevron"></i>
                ${item.title}
                ${linksHtml}
              </div>
              <div class="desc" style="margin-left: 24px;">${item.description}</div>
            </td>
            <td><span class="badge badge-${statusClass}">${statusLabel}</span></td>
            <td>
              ${item.progress !== undefined ? `
                <div class="progress"><div class="progress-bar" style="width: ${item.progress}%"></div></div>
                <div class="progress-text">${item.progress}%</div>
              ` : '<span style="color: #555">â€”</span>'}
            </td>
            <td style="color: #666">${formatDate(item.updated || item.completed || item.created)}</td>
          </tr>
          <tr class="expanded-row" data-parent="${item.id}" style="display: none;">
            <td colspan="4" class="expanded-content">
              ${item.prd ? `
                <div class="detail-row">
                  <span class="detail-label">PRD</span>
                  <span class="detail-value">${item.prd}</span>
                </div>
              ` : ''}
              ${item.blocked ? `
                <div class="detail-row">
                  <span class="detail-label">Blocked</span>
                  <span class="detail-value" style="color: #d4a33a;">âš ï¸ ${item.blocked}</span>
                </div>
              ` : ''}
              <div class="detail-row">
                <span class="detail-label">Created</span>
                <span class="detail-value">${new Date(item.created).toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'})}</span>
              </div>
              ${subtasksHtml ? `
                <div class="subtasks">
                  <div style="font-size: 13px; color: #666; margin-bottom: 10px;">Sub-tasks</div>
                  ${subtasksHtml}
                </div>
              ` : ''}
            </td>
          </tr>
        `;
      }).join('');
      
      // Add click handlers for expandable rows
      document.querySelectorAll('#projectsTable tr.clickable').forEach(row => {
        row.addEventListener('click', () => {
          const id = row.dataset.id;
          const expandedRow = document.querySelector(`tr.expanded-row[data-parent="${id}"]`);
          const isExpanded = row.classList.contains('expanded');
          
          // Collapse all
          document.querySelectorAll('#projectsTable tr.clickable').forEach(r => r.classList.remove('expanded'));
          document.querySelectorAll('#projectsTable tr.expanded-row').forEach(r => r.style.display = 'none');
          
          // Expand clicked if wasn't already expanded
          if (!isExpanded) {
            row.classList.add('expanded');
            expandedRow.style.display = 'table-row';
          }
          
          lucide.createIcons();
        });
      });

      // Tasks table (type === 'task')
      const taskItems = items.filter(i => i.type === 'task' && i.status !== 'idea');
      document.getElementById('tasksTable').innerHTML = taskItems.map(item => {
        const statusClass = item.blocked ? 'blocked' : item.status;
        const statusLabel = item.blocked ? 'â¸ï¸ Blocked' : 
                          item.status === 'active' ? 'ðŸ”„ Active' :
                          item.status === 'done' ? 'âœ“ Done' : 'â—‹ Ready';
        const checkmark = item.status === 'done' ? 'â˜‘' : 'â˜';
        
        return `
          <tr>
            <td>
              <div class="title" style="display: flex; align-items: center; gap: 8px;">
                <span style="color: ${item.status === 'done' ? '#4ade80' : '#555'}">${checkmark}</span>
                <span style="${item.status === 'done' ? 'color: #888;' : ''}">${item.title}</span>
              </div>
              ${item.blocked ? `<div style="color: #d4a33a; font-size: 12px; margin-top: 4px; margin-left: 24px;">âš ï¸ ${item.blocked}</div>` : ''}
            </td>
            <td><span class="badge badge-${statusClass}">${statusLabel}</span></td>
            <td style="color: #666">${formatDate(item.completed || item.updated || item.created)}</td>
          </tr>
        `;
      }).join('');

      // Show/hide sections based on content
      document.getElementById('projectsSection').style.display = projectItems.length ? 'block' : 'none';
      document.getElementById('tasksSection').style.display = taskItems.length ? 'block' : 'none';

      // Ideas
      const ideaItems = currentFilter === 'all' || currentFilter === 'idea' 
        ? data.items.filter(i => i.status === 'idea') 
        : [];
      
      document.getElementById('ideasSection').style.display = ideaItems.length ? 'block' : 'none';
      document.getElementById('ideasList').innerHTML = ideaItems.map(item => `
        <div class="idea-item">
          <i data-lucide="lightbulb" style="width:22px;height:22px;color:#a585d4;flex-shrink:0;margin-top:2px;"></i>
          <div>
            <div class="idea-title">${item.title}</div>
            <div class="idea-desc">${item.description}</div>
          </div>
        </div>
      `).join('');
      lucide.createIcons();

      // Activity
      document.getElementById('activityList').innerHTML = data.recentActivity.slice(0, 6).map((item, i) => `
        <div class="activity-item">
          <span class="activity-time">${formatTime(item.time)}</span>
          <div class="activity-dot ${i === 0 ? 'active' : ''}"></div>
          <span class="activity-text">${item.action}</span>
        </div>
      `).join('');

      // Tools - grouped by category
      if (data.tools) {
        document.getElementById('navTools').textContent = data.tools.length;
        
        // Group by category
        const byCategory = {};
        data.tools.forEach(t => {
          if (!byCategory[t.category]) byCategory[t.category] = [];
          byCategory[t.category].push(t);
        });
        
        // Category order and colors
        const categoryOrder = ['AI', 'Finance', 'Communication', 'Development', 'Search', 'Social', 'Health', 'Productivity', 'Media', 'Travel', 'Account', 'Utilities'];
        const categoryColors = {
          'AI': '#8b5cf6',
          'Finance': '#22c55e',
          'Communication': '#3b82f6',
          'Development': '#f59e0b',
          'Search': '#06b6d4',
          'Social': '#ec4899',
          'Health': '#ef4444',
          'Productivity': '#84cc16',
          'Media': '#f97316',
          'Travel': '#14b8a6',
          'Account': '#6366f1',
          'Utilities': '#64748b',
        };
        
        // Type icons
        const typeIcons = {
          'api': 'ðŸ”Œ',
          'web': 'ðŸŒ',
          'cli': 'âŒ¨ï¸',
          'skill': 'ðŸ§©',
          'account': 'ðŸ”‘',
        };
        
        let html = '';
        categoryOrder.forEach(category => {
          if (!byCategory[category]) return;
          const tools = byCategory[category];
          const color = categoryColors[category] || '#666';
          
          html += `
            <tr>
              <td colspan="4" style="padding: 16px 0 8px 0; border-bottom: none;">
                <span style="color: ${color}; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                  ${category} (${tools.length})
                </span>
              </td>
            </tr>
          `;
          
          tools.forEach(tool => {
            const statusBadge = tool.status === 'active'
              ? `<span class="badge badge-done">âœ“ Active</span>`
              : `<span class="badge badge-queue">Inactive</span>`;
            
            const typeIcon = typeIcons[tool.type] || 'ðŸ”§';
            const capsList = tool.capabilities && tool.capabilities.length > 0
              ? `<div style="margin-top: 6px; display: flex; flex-wrap: wrap; gap: 4px;">
                  ${tool.capabilities.slice(0, 4).map(c => `<span style="background: #1a1a2e; color: #888; padding: 2px 6px; border-radius: 4px; font-size: 10px;">${c}</span>`).join('')}
                  ${tool.capabilities.length > 4 ? `<span style="color: #555; font-size: 10px;">+${tool.capabilities.length - 4} more</span>` : ''}
                </div>`
              : '';
            
            html += `
              <tr>
                <td style="width: 250px;">
                  <div class="title" style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 16px;">${tool.icon || typeIcon}</span>
                    ${tool.url ? `<a href="${tool.url}" target="_blank" style="color: inherit; text-decoration: none;">${tool.name}</a>` : tool.name}
                    <span style="font-size: 10px; color: #555; background: #222; padding: 1px 5px; border-radius: 3px;">${tool.type}</span>
                  </div>
                  <div style="color: #555; font-size: 11px; margin-top: 2px;">${tool.auth || ''}</div>
                </td>
                <td>
                  <div style="color: #888; font-size: 13px;">${tool.description}</div>
                  ${capsList}
                </td>
                <td style="width: 100px;">${statusBadge}</td>
              </tr>
            `;
          });
        });
        
        document.getElementById('toolsTable').innerHTML = html;
      }

      // Crons
      if (data.crons) {
        document.getElementById('navCrons').textContent = data.crons.length;
        window._allCrons = data.crons;
        renderCronTable(data.crons);
        
        // Wire up filter buttons
        document.querySelectorAll('.cron-filter-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.cron-filter-btn').forEach(b => {
              b.classList.remove('active');
              b.style.background = 'transparent';
            });
            btn.classList.add('active');
            btn.style.background = '#232323';
            const agent = btn.dataset.agent;
            if (agent === 'all') {
              renderCronTable(window._allCrons);
            } else if (agent === 'system') {
              renderCronTable(window._allCrons.filter(c => c.model === 'system' || !c.model));
            } else {
              renderCronTable(window._allCrons.filter(c => c.agent === agent));
            }
          });
        });
      }

      // Files
      if (data.files) {
        document.getElementById('navFiles').textContent = data.files.length;
        document.getElementById('filesTable').innerHTML = data.files.map(file => {
          const catColors = {
            'Identity': '#8b5cf6',
            'Memory': '#4ade80',
            'System': '#f59e0b',
            'Work': '#3b82f6'
          };
          const color = catColors[file.category] || '#666';
          return `
            <tr class="clickable" onclick="viewFile('${file.name}')" style="cursor: pointer;">
              <td>
                <div class="title" style="display: flex; align-items: center; gap: 8px;">
                  <i data-lucide="file-text" style="width: 16px; height: 16px; color: ${color};"></i>
                  ${file.name}
                </div>
              </td>
              <td style="color: #999">${file.desc}</td>
              <td><span class="badge" style="background: ${color}22; color: ${color}; font-size: 12px;">${file.category}</span></td>
            </tr>
          `;
        }).join('');
        lucide.createIcons();
      }

      // Docs
      if (data.docs) {
        document.getElementById('navDocs').textContent = data.docs.length;
      }

      // Last updated
      document.getElementById('lastUpdated').textContent = 
        new Date(data.lastUpdated).toLocaleString('en-US', { 
          month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' 
        });
    }

    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', () => {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        currentFilter = item.dataset.filter;
        const titles = {
          all: 'All Items',
          active: 'Active',
          queue: 'Queue',
          done: 'Completed',
          archived: 'Archived',
          tools: 'Tools & APIs',
          crons: 'Cron Jobs',
          files: 'Core Files',
          docs: 'Documents',
          'daily-logs': 'Daily Logs',
          'notes': 'Notes',
          'skills': 'Skills',
          'tasks': 'Tasks',
          'projects': 'Projects',
          'org-chart': 'Org Chart',
          'projects-hub': 'Projects Hub'
        };
        document.getElementById('pageTitle').textContent = titles[currentFilter];
        
        // Show/hide sections based on filter
        const toolsSection = document.getElementById('toolsSection');
        const projectsSection = document.getElementById('projectsSection');
        const activitySection = document.getElementById('activitySection');
        const statsRow = document.querySelector('.stats-row'); // may be null
        const currentBanner = document.getElementById('currentBanner'); // may be null
        
        const cronsSection = document.getElementById('cronsSection');
        
        if (currentFilter === 'tools') {
          toolsSection.style.display = 'block';
          cronsSection.style.display = 'none';
          document.getElementById('filesSection').style.display = 'none';
          document.getElementById('dailyLogsSection').style.display = 'none';
          document.getElementById('skillsSection').style.display = 'none';
          document.getElementById('docsSection').style.display = 'none';
          document.getElementById('tasksFullSection').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'none';
          document.getElementById('orgChartSection').style.display = 'none';
          document.getElementById('notesSection').style.display = 'none';
          projectsSection.style.display = 'none';
          document.getElementById('tasksSection').style.display = 'none';
          activitySection.style.display = 'none';
          if (statsRow) statsRow.style.display = 'none';
          if (currentBanner) currentBanner.style.display = 'none';
          document.getElementById('ideasSection').style.display = 'none';
          document.getElementById('commandCenter').style.display = 'none';
        } else if (currentFilter === 'crons') {
          toolsSection.style.display = 'none';
          cronsSection.style.display = 'block';
          document.getElementById('filesSection').style.display = 'none';
          document.getElementById('dailyLogsSection').style.display = 'none';
          document.getElementById('skillsSection').style.display = 'none';
          document.getElementById('docsSection').style.display = 'none';
          document.getElementById('tasksFullSection').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'none';
          document.getElementById('orgChartSection').style.display = 'none';
          document.getElementById('notesSection').style.display = 'none';
          projectsSection.style.display = 'none';
          document.getElementById('tasksSection').style.display = 'none';
          activitySection.style.display = 'none';
          if (statsRow) statsRow.style.display = 'none';
          if (currentBanner) currentBanner.style.display = 'none';
          document.getElementById('ideasSection').style.display = 'none';
          document.getElementById('commandCenter').style.display = 'none';
        } else if (currentFilter === 'files') {
          toolsSection.style.display = 'none';
          cronsSection.style.display = 'none';
          document.getElementById('filesSection').style.display = 'block';
          document.getElementById('dailyLogsSection').style.display = 'none';
          document.getElementById('skillsSection').style.display = 'none';
          document.getElementById('docsSection').style.display = 'none';
          document.getElementById('tasksFullSection').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'none';
          document.getElementById('orgChartSection').style.display = 'none';
          document.getElementById('notesSection').style.display = 'none';
          projectsSection.style.display = 'none';
          document.getElementById('tasksSection').style.display = 'none';
          activitySection.style.display = 'none';
          if (statsRow) statsRow.style.display = 'none';
          if (currentBanner) currentBanner.style.display = 'none';
          document.getElementById('ideasSection').style.display = 'none';
          document.getElementById('commandCenter').style.display = 'none';
        } else if (currentFilter === 'daily-logs') {
          toolsSection.style.display = 'none';
          cronsSection.style.display = 'none';
          document.getElementById('filesSection').style.display = 'none';
          document.getElementById('dailyLogsSection').style.display = 'block';
          document.getElementById('skillsSection').style.display = 'none';
          document.getElementById('docsSection').style.display = 'none';
          document.getElementById('tasksFullSection').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'none';
          document.getElementById('orgChartSection').style.display = 'none';
          document.getElementById('notesSection').style.display = 'none';
          projectsSection.style.display = 'none';
          document.getElementById('tasksSection').style.display = 'none';
          activitySection.style.display = 'none';
          if (statsRow) statsRow.style.display = 'none';
          if (currentBanner) currentBanner.style.display = 'none';
          document.getElementById('ideasSection').style.display = 'none';
          document.getElementById('commandCenter').style.display = 'none';
          renderDailyLogs();
        } else if (currentFilter === 'notes') {
          toolsSection.style.display = 'none';
          cronsSection.style.display = 'none';
          document.getElementById('filesSection').style.display = 'none';
          document.getElementById('dailyLogsSection').style.display = 'none';
          document.getElementById('skillsSection').style.display = 'none';
          document.getElementById('docsSection').style.display = 'none';
          document.getElementById('tasksFullSection').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'none';
          document.getElementById('orgChartSection').style.display = 'none';
          document.getElementById('notesSection').style.display = 'block';
          projectsSection.style.display = 'none';
          document.getElementById('tasksSection').style.display = 'none';
          activitySection.style.display = 'none';
          if (statsRow) statsRow.style.display = 'none';
          if (currentBanner) currentBanner.style.display = 'none';
          document.getElementById('ideasSection').style.display = 'none';
          document.getElementById('commandCenter').style.display = 'none';
          renderNotes();
        } else if (currentFilter === 'skills') {
          toolsSection.style.display = 'none';
          cronsSection.style.display = 'none';
          document.getElementById('filesSection').style.display = 'none';
          document.getElementById('dailyLogsSection').style.display = 'none';
          document.getElementById('skillsSection').style.display = 'block';
          document.getElementById('docsSection').style.display = 'none';
          document.getElementById('tasksFullSection').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'none';
          document.getElementById('orgChartSection').style.display = 'none';
          document.getElementById('notesSection').style.display = 'none';
          projectsSection.style.display = 'none';
          document.getElementById('tasksSection').style.display = 'none';
          activitySection.style.display = 'none';
          if (statsRow) statsRow.style.display = 'none';
          if (currentBanner) currentBanner.style.display = 'none';
          document.getElementById('ideasSection').style.display = 'none';
          document.getElementById('commandCenter').style.display = 'none';
          renderSkills();
        } else if (currentFilter === 'tasks') {
          toolsSection.style.display = 'none';
          cronsSection.style.display = 'none';
          document.getElementById('filesSection').style.display = 'none';
          document.getElementById('dailyLogsSection').style.display = 'none';
          document.getElementById('skillsSection').style.display = 'none';
          document.getElementById('docsSection').style.display = 'none';
          document.getElementById('tasksFullSection').style.display = 'block';
          document.getElementById('orgChartSection').style.display = 'none';
          document.getElementById('notesSection').style.display = 'none';
          projectsSection.style.display = 'none';
          document.getElementById('tasksSection').style.display = 'none';
          activitySection.style.display = 'none';
          if (statsRow) statsRow.style.display = 'none';
          if (currentBanner) currentBanner.style.display = 'none';
          document.getElementById('ideasSection').style.display = 'none';
          document.getElementById('commandCenter').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'none';
          renderTasks();
        } else if (currentFilter === 'docs') {
          toolsSection.style.display = 'none';
          cronsSection.style.display = 'none';
          document.getElementById('filesSection').style.display = 'none';
          document.getElementById('dailyLogsSection').style.display = 'none';
          document.getElementById('skillsSection').style.display = 'none';
          document.getElementById('docsSection').style.display = 'block';
          document.getElementById('tasksFullSection').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'none';
          document.getElementById('orgChartSection').style.display = 'none';
          document.getElementById('notesSection').style.display = 'none';
          projectsSection.style.display = 'none';
          document.getElementById('tasksSection').style.display = 'none';
          activitySection.style.display = 'none';
          if (statsRow) statsRow.style.display = 'none';
          if (currentBanner) currentBanner.style.display = 'none';
          document.getElementById('ideasSection').style.display = 'none';
          document.getElementById('commandCenter').style.display = 'none';
          renderDocs();
        } else if (currentFilter === 'projects' || currentFilter === 'projects-hub') {
          toolsSection.style.display = 'none';
          cronsSection.style.display = 'none';
          document.getElementById('filesSection').style.display = 'none';
          document.getElementById('dailyLogsSection').style.display = 'none';
          document.getElementById('skillsSection').style.display = 'none';
          document.getElementById('docsSection').style.display = 'none';
          document.getElementById('tasksFullSection').style.display = 'none';
          document.getElementById('orgChartSection').style.display = 'none';
          document.getElementById('notesSection').style.display = 'none';
          projectsSection.style.display = 'none';
          document.getElementById('tasksSection').style.display = 'none';
          activitySection.style.display = 'none';
          if (statsRow) statsRow.style.display = 'none';
          if (currentBanner) currentBanner.style.display = 'none';
          document.getElementById('ideasSection').style.display = 'none';
          document.getElementById('commandCenter').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'block';
          renderProjectsHub();
        } else if (currentFilter === 'org-chart') {
          toolsSection.style.display = 'none';
          cronsSection.style.display = 'none';
          document.getElementById('filesSection').style.display = 'none';
          document.getElementById('dailyLogsSection').style.display = 'none';
          document.getElementById('skillsSection').style.display = 'none';
          document.getElementById('docsSection').style.display = 'none';
          document.getElementById('tasksFullSection').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'none';
          document.getElementById('orgChartSection').style.display = 'block';
          document.getElementById('notesSection').style.display = 'none';
          projectsSection.style.display = 'none';
          document.getElementById('tasksSection').style.display = 'none';
          activitySection.style.display = 'none';
          if (statsRow) statsRow.style.display = 'none';
          if (currentBanner) currentBanner.style.display = 'none';
          document.getElementById('ideasSection').style.display = 'none';
          document.getElementById('commandCenter').style.display = 'none';
          renderOrgChart();
        } else {
          toolsSection.style.display = 'none';
          cronsSection.style.display = 'none';
          document.getElementById('filesSection').style.display = 'none';
          document.getElementById('dailyLogsSection').style.display = 'none';
          document.getElementById('skillsSection').style.display = 'none';
          document.getElementById('docsSection').style.display = 'none';
          document.getElementById('tasksFullSection').style.display = 'none';
          document.getElementById('projectsHubSection').style.display = 'none';
          document.getElementById('orgChartSection').style.display = 'none';
          document.getElementById('notesSection').style.display = 'none';
          projectsSection.style.display = 'block';
          document.getElementById('tasksSection').style.display = 'block';
          activitySection.style.display = 'block';
          if (statsRow) statsRow.style.display = 'flex';
          document.getElementById('commandCenter').style.display = 'grid';
          if (currentBanner) currentBanner.style.display = 'flex';
          render();
          return;
        }
      });
    });

    // File viewer functions
    async function viewFile(filename) {
      try {
        const response = await fetch('files/' + filename + '?' + Date.now());
        const content = await response.text();
        document.getElementById('fileViewerTitle').textContent = filename;
        document.getElementById('fileContent').textContent = content;
        document.getElementById('fileViewer').style.display = 'block';
      } catch (e) {
        document.getElementById('fileViewerTitle').textContent = filename;
        document.getElementById('fileContent').textContent = 'âš ï¸ Could not load file. Make sure files are synced to the files/ folder.';
        document.getElementById('fileViewer').style.display = 'block';
      }
    }

    function closeFileViewer() {
      document.getElementById('fileViewer').style.display = 'none';
    }

    // Tasks System
    let tasksData = [];
    let allProjectsForTasks = [];
    let currentTasksFilter = 'all';
    let tasksSearchQuery = '';

    async function loadTasks() {
      try {
        // Load tasks
        tasksData = await convexClient.query("tasks:list", {});
        
        // Load projects for dropdown
        allProjectsForTasks = await convexClient.query("projects:list");
        
        // Update nav count
        const activeCount = tasksData.filter(t => t.status !== 'done').length;
        document.getElementById('navTasks').textContent = activeCount;
        
        console.log('âœ“ Loaded tasks from Convex:', activeCount, 'active');
      } catch (e) {
        console.error('Failed to load tasks from Convex:', e);
        tasksData = [];
      }
    }

    function renderTasks() {
      // Populate project dropdown
      const projectSelect = document.getElementById('taskFormProject');
      projectSelect.innerHTML = '<option value="">None (Personal)</option>' + 
        allProjectsForTasks.map(p => `<option value="${p._id}">${p.title}</option>`).join('');
      
      // Calculate stats
      const now = new Date();
      const today = now.toISOString().split('T')[0];
      const weekEnd = new Date(now);
      weekEnd.setDate(weekEnd.getDate() + 7);
      const weekEndStr = weekEnd.toISOString().split('T')[0];
      
      const activeTasks = tasksData.filter(t => t.status !== 'done');
      const completedTasks = tasksData.filter(t => t.status === 'done');
      const dueToday = activeTasks.filter(t => t.dueDate === today).length;
      const dueThisWeek = activeTasks.filter(t => t.dueDate && t.dueDate >= today && t.dueDate <= weekEndStr).length;
      
      document.getElementById('tasksStatActive').textContent = activeTasks.length;
      document.getElementById('tasksStatDueToday').textContent = dueToday;
      document.getElementById('tasksStatThisWeek').textContent = dueThisWeek;
      document.getElementById('tasksStatCompleted').textContent = completedTasks.length;
      
      // Upcoming reminders
      const upcomingReminders = activeTasks
        .filter(t => t.reminder && !t.reminder.fired)
        .sort((a, b) => new Date(a.reminder.at) - new Date(b.reminder.at))
        .slice(0, 3);
      
      const remindersStrip = document.getElementById('tasksRemindersStrip');
      if (upcomingReminders.length > 0) {
        remindersStrip.style.display = 'block';
        document.getElementById('tasksRemindersList').innerHTML = upcomingReminders.map(t => {
          const reminderDate = new Date(t.reminder.at);
          const isToday = reminderDate.toDateString() === now.toDateString();
          const timeStr = isToday 
            ? `Today ${reminderDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}`
            : reminderDate.toLocaleDateString('en-US', { weekday: 'short', hour: 'numeric', minute: '2-digit' });
          return `<div class="tasks-reminder-item">
            <span class="tasks-reminder-time">${timeStr}</span>
            <span class="tasks-reminder-text">${t.title}</span>
          </div>`;
        }).join('');
      } else {
        remindersStrip.style.display = 'none';
      }
      
      // Setup filter tabs
      document.querySelectorAll('.tasks-filter-tab').forEach(tab => {
        tab.onclick = () => {
          document.querySelectorAll('.tasks-filter-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentTasksFilter = tab.dataset.filter;
          renderTasksGroups();
        };
      });
      
      // Setup search
      document.getElementById('tasksSearchInput').oninput = (e) => {
        tasksSearchQuery = e.target.value.toLowerCase();
        renderTasksGroups();
      };
      
      renderTasksGroups();
    }

    function renderTasksGroups() {
      const container = document.getElementById('tasksGroupsContainer');
      const now = new Date();
      const today = now.toISOString().split('T')[0];
      const weekEnd = new Date(now);
      weekEnd.setDate(weekEnd.getDate() + 7);
      const weekEndStr = weekEnd.toISOString().split('T')[0];
      
      // Filter tasks
      let tasks = [...tasksData];
      
      // Apply type filter
      if (currentTasksFilter === 'personal') {
        tasks = tasks.filter(t => t.type === 'personal');
      } else if (currentTasksFilter === 'project') {
        tasks = tasks.filter(t => t.type === 'project');
      } else if (currentTasksFilter === 'reminders') {
        tasks = tasks.filter(t => t.reminder && !t.reminder.fired);
      }
      
      // Apply search
      if (tasksSearchQuery) {
        tasks = tasks.filter(t => t.title.toLowerCase().includes(tasksSearchQuery));
      }
      
      // Separate active and completed
      const activeTasks = tasks.filter(t => t.status !== 'done');
      const completedTasks = tasks.filter(t => t.status === 'done');
      
      // Group active tasks by urgency
      const overdue = activeTasks.filter(t => t.dueDate && t.dueDate < today);
      const dueToday = activeTasks.filter(t => t.dueDate === today);
      const thisWeek = activeTasks.filter(t => t.dueDate && t.dueDate > today && t.dueDate <= weekEndStr);
      const backlog = activeTasks.filter(t => !t.dueDate || t.dueDate > weekEndStr);
      
      if (activeTasks.length === 0 && completedTasks.length === 0) {
        container.innerHTML = '<div class="todo-empty">No tasks yet. Click "New Task" to add one!</div>';
        return;
      }
      
      let html = '';
      
      // Overdue
      if (overdue.length > 0) {
        html += renderTaskGroup('OVERDUE', overdue, '#f87171', 'alert-triangle');
      }
      
      // Today
      if (dueToday.length > 0) {
        html += renderTaskGroup('TODAY', dueToday, '#fbbf24', 'clock');
      }
      
      // This Week
      if (thisWeek.length > 0) {
        html += renderTaskGroup('THIS WEEK', thisWeek, '#555', 'calendar');
      }
      
      // Backlog
      if (backlog.length > 0) {
        html += renderTaskGroup('BACKLOG', backlog, '#555', 'activity');
      }
      
      // Add task inline
      html += `
        <div class="add-task-inline" onclick="openTaskModal()">
          <i data-lucide="plus" style="width: 16px; height: 16px; color: #444;"></i>
          <span>Add task...</span>
        </div>
      `;
      
      // Completed (show recent 5)
      if (completedTasks.length > 0) {
        const recentCompleted = completedTasks.slice(0, 5);
        html += renderTaskGroup(`COMPLETED Â· ${completedTasks.length} total Â· showing recent`, recentCompleted, '#4ade80', 'check-circle', true);
      }
      
      container.innerHTML = html;
      lucide.createIcons();
      
      // Wire up task item clicks
      container.querySelectorAll('.task-check').forEach(check => {
        check.onclick = (e) => {
          e.stopPropagation();
          const taskId = check.dataset.id;
          const isDone = check.classList.contains('checked');
          if (isDone) {
            reopenTask(taskId);
          } else {
            completeTask(taskId);
          }
        };
      });
      
      container.querySelectorAll('.task-edit-btn').forEach(btn => {
        btn.onclick = (e) => {
          e.stopPropagation();
          openTaskModal(btn.dataset.id);
        };
      });
      
      container.querySelectorAll('.task-delete-btn').forEach(btn => {
        btn.onclick = (e) => {
          e.stopPropagation();
          if (confirm('Delete this task?')) {
            deleteTask(btn.dataset.id);
          }
        };
      });
    }

    function renderTaskGroup(title, tasks, color, icon, isDone = false) {
      const now = new Date();
      const today = now.toISOString().split('T')[0];
      
      return `
        <div class="tasks-group">
          <div class="tasks-group-header" style="color: ${color};">
            <i data-lucide="${icon}" style="width: 12px; height: 12px;"></i>
            ${title} <span class="group-count">Â· ${tasks.length}</span>
          </div>
          ${tasks.map(task => {
            const project = task.projectId ? allProjectsForTasks.find(p => p._id === task.projectId) : null;
            const priorityClass = task.priority || 'medium';
            const checkClass = isDone ? 'checked' : priorityClass;
            
            // Due date formatting
            let dueDateHtml = '';
            if (task.dueDate && !isDone) {
              const dueClass = task.dueDate < today ? 'overdue' : (task.dueDate === today ? 'today' : 'upcoming');
              const dueDate = new Date(task.dueDate + 'T12:00:00');
              const dueDateStr = task.dueDate === today ? 'Today' : 
                task.dueDate < today ? `${dueDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} â€” ${Math.ceil((new Date(today) - dueDate) / (1000*60*60*24))} days overdue` :
                dueDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
              dueDateHtml = `<span class="task-due ${dueClass}"><i data-lucide="clock" style="width: 12px; height: 12px;"></i>${dueDateStr}</span>`;
            } else if (task.completedAt && isDone) {
              const compDate = new Date(task.completedAt);
              dueDateHtml = `<span class="task-due upcoming"><i data-lucide="clock" style="width: 12px; height: 12px;"></i>Done ${compDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>`;
            }
            
            // Reminder badge
            let reminderHtml = '';
            if (task.reminder && !task.reminder.fired && !isDone) {
              const reminderDate = new Date(task.reminder.at);
              const reminderStr = reminderDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' });
              reminderHtml = `<span class="task-reminder-badge"><i data-lucide="bell" style="width: 12px; height: 12px;"></i>Reminder ${reminderStr}</span>`;
            }
            
            return `
              <div class="task-item ${isDone ? 'done' : ''}">
                <div class="task-check ${checkClass}" data-id="${task._id}"></div>
                <div class="task-body">
                  <div class="task-title">${task.title}</div>
                  ${task.description ? `<div class="task-desc">${task.description}</div>` : ''}
                  <div class="task-meta">
                    ${task.type === 'project' && project ? `<span class="task-tag tag-project">${project.title}</span>` : ''}
                    ${task.type === 'personal' ? `<span class="task-tag tag-personal">personal</span>` : ''}
                    ${task.assignee ? `<span class="task-tag tag-assignee">${task.assignee}</span>` : ''}
                    ${task.category ? `<span class="task-tag tag-category">${task.category}</span>` : ''}
                    ${dueDateHtml}
                    ${reminderHtml}
                  </div>
                </div>
                ${!isDone ? `
                  <div class="task-actions">
                    <button class="task-action-btn task-edit-btn" data-id="${task._id}" title="Edit">
                      <i data-lucide="pencil" style="width: 14px; height: 14px;"></i>
                    </button>
                    <button class="task-action-btn delete task-delete-btn" data-id="${task._id}" title="Delete">
                      <i data-lucide="trash-2" style="width: 14px; height: 14px;"></i>
                    </button>
                  </div>
                ` : ''}
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    function toggleReminderFields() {
      const toggle = document.getElementById('taskFormReminderToggle');
      const fields = document.getElementById('taskReminderFields');
      fields.style.display = toggle.classList.contains('on') ? 'flex' : 'none';
    }

    function openTaskModal(editId = null) {
      const modal = document.getElementById('taskModalOverlay');
      const title = document.getElementById('taskModalTitle');
      const saveBtn = document.querySelector('.task-btn-save');
      
      // Reset form
      document.getElementById('taskEditId').value = '';
      document.getElementById('taskFormTitle').value = '';
      document.getElementById('taskFormDesc').value = '';
      document.getElementById('taskFormType').value = 'personal';
      document.getElementById('taskFormPriority').value = 'medium';
      document.getElementById('taskFormProject').value = '';
      document.getElementById('taskFormAssignee').value = '';
      document.getElementById('taskFormDueDate').value = '';
      document.getElementById('taskFormCategory').value = '';
      document.getElementById('taskFormReminderToggle').classList.remove('on');
      document.getElementById('taskReminderFields').style.display = 'none';
      document.getElementById('taskFormReminderAt').value = '';
      document.getElementById('taskFormReminderRepeat').value = 'never';
      
      if (editId) {
        const task = tasksData.find(t => t._id === editId);
        if (task) {
          document.getElementById('taskEditId').value = editId;
          document.getElementById('taskFormTitle').value = task.title || '';
          document.getElementById('taskFormDesc').value = task.description || '';
          document.getElementById('taskFormType').value = task.type || 'personal';
          document.getElementById('taskFormPriority').value = task.priority || 'medium';
          document.getElementById('taskFormProject').value = task.projectId || '';
          document.getElementById('taskFormAssignee').value = task.assignee || '';
          document.getElementById('taskFormDueDate').value = task.dueDate || '';
          document.getElementById('taskFormCategory').value = task.category || '';
          
          if (task.reminder) {
            document.getElementById('taskFormReminderToggle').classList.add('on');
            document.getElementById('taskReminderFields').style.display = 'flex';
            document.getElementById('taskFormReminderAt').value = task.reminder.at ? task.reminder.at.slice(0, 16) : '';
            document.getElementById('taskFormReminderRepeat').value = task.reminder.repeat || 'never';
          }
          
          title.textContent = 'Edit Task';
          saveBtn.textContent = 'Save Changes';
        }
      } else {
        title.textContent = 'New Task';
        saveBtn.textContent = 'Create Task';
      }
      
      modal.classList.add('active');
    }

    function closeTaskModal() {
      document.getElementById('taskModalOverlay').classList.remove('active');
    }

    async function saveTask() {
      const editId = document.getElementById('taskEditId').value;
      const title = document.getElementById('taskFormTitle').value.trim();
      if (!title) {
        alert('Please enter a title');
        return;
      }
      
      const taskData = {
        title,
        description: document.getElementById('taskFormDesc').value.trim() || undefined,
        type: document.getElementById('taskFormType').value,
        priority: document.getElementById('taskFormPriority').value,
        projectId: document.getElementById('taskFormProject').value || undefined,
        assignee: document.getElementById('taskFormAssignee').value || undefined,
        dueDate: document.getElementById('taskFormDueDate').value || undefined,
        category: document.getElementById('taskFormCategory').value || undefined,
      };
      
      // Handle reminder
      const reminderOn = document.getElementById('taskFormReminderToggle').classList.contains('on');
      if (reminderOn) {
        const reminderAt = document.getElementById('taskFormReminderAt').value;
        if (reminderAt) {
          taskData.reminder = {
            at: new Date(reminderAt).toISOString(),
            repeat: document.getElementById('taskFormReminderRepeat').value,
            fired: false,
          };
        }
      }
      
      try {
        if (editId) {
          await convexClient.mutation("tasks:update", { id: editId, ...taskData });
          showToast('Task updated');
        } else {
          await convexClient.mutation("tasks:add", taskData);
          showToast('Task created');
        }
        closeTaskModal();
        await loadTasks();
        renderTasks();
      } catch (e) {
        console.error('Failed to save task:', e);
        alert('Failed to save task');
      }
    }

    async function completeTask(taskId) {
      try {
        await convexClient.mutation("tasks:complete", { id: taskId });
        showToast('Task completed');
        await loadTasks();
        renderTasks();
      } catch (e) {
        console.error('Failed to complete task:', e);
      }
    }

    async function reopenTask(taskId) {
      try {
        await convexClient.mutation("tasks:reopen", { id: taskId });
        showToast('Task reopened');
        await loadTasks();
        renderTasks();
      } catch (e) {
        console.error('Failed to reopen task:', e);
      }
    }

    async function deleteTask(taskId) {
      try {
        await convexClient.mutation("tasks:remove", { id: taskId });
        showToast('Task deleted');
        await loadTasks();
        renderTasks();
      } catch (e) {
        console.error('Failed to delete task:', e);
      }
    }

    // Docs functions
    function renderDocs() {
      if (!data || !data.docs) return;
      const catColors = {
        'Health': '#4ade80',
        'Trading': '#f59e0b',
        'Research': '#3b82f6',
        'Travel': '#8b5cf6',
        'Reference': '#ec4899'
      };
      document.getElementById('docsTable').innerHTML = data.docs.map(doc => {
        const color = catColors[doc.category] || '#666';
        return `
          <tr class="clickable" onclick="viewDoc('${doc.path}')" style="cursor: pointer;">
            <td>
              <div class="title" style="display: flex; align-items: center; gap: 8px;">
                <i data-lucide="file-text" style="width: 16px; height: 16px; color: ${color};"></i>
                ${doc.name}
              </div>
            </td>
            <td style="color: #999">${doc.desc}</td>
            <td><span class="badge" style="background: ${color}22; color: ${color}; font-size: 12px;">${doc.category}</span></td>
            <td style="color: #666; font-size: 13px;">${doc.updated || '-'}</td>
          </tr>
        `;
      }).join('');
      lucide.createIcons();
    }

    async function viewDoc(docPath) {
      try {
        const response = await fetch('docs/' + docPath + '?' + Date.now());
        const content = await response.text();
        document.getElementById('docViewerTitle').textContent = docPath.split('/').pop();
        // Enhanced markdown-to-html conversion
        let html = content
          // Headers
          .replace(/^#### (.*$)/gm, '<h5 style="color:#e5e5e5;font-size:14px;font-weight:600;margin:14px 0 6px;letter-spacing:0.3px;">$1</h5>')
          .replace(/^### (.*$)/gm, '<h4 style="color:#fff;font-size:15px;font-weight:600;margin:18px 0 8px;letter-spacing:0.3px;">$1</h4>')
          .replace(/^## (.*$)/gm, '<h3 style="color:#fff;font-size:17px;font-weight:600;margin:24px 0 10px;padding-bottom:6px;border-bottom:1px solid #2a2a2a;">$1</h3>')
          .replace(/^# (.*$)/gm, '<h2 style="color:#fff;font-size:20px;font-weight:600;margin:0 0 16px;padding-bottom:8px;border-bottom:1px solid #333;">$1</h2>')
          // Text formatting
          .replace(/\*\*(.*?)\*\*/g, '<strong style="color:#fff;font-weight:600;">$1</strong>')
          .replace(/\*(.*?)\*/g, '<em style="color:#bbb;">$1</em>')
          .replace(/`([^`]+)`/g, '<code style="background:#252525;padding:2px 6px;border-radius:4px;font-size:13px;color:#4ade80;">$1</code>')
          // Lists
          .replace(/^- (.*$)/gm, '<div style="display:flex;gap:8px;margin:4px 0 4px 8px;"><span style="color:#4ade80;">â€¢</span><span>$1</span></div>')
          .replace(/^â€¢ (.*$)/gm, '<div style="display:flex;gap:8px;margin:4px 0 4px 8px;"><span style="color:#4ade80;">â€¢</span><span>$1</span></div>')
          // Dividers
          .replace(/^---$/gm, '<hr style="border:none;border-top:1px solid #2a2a2a;margin:20px 0;">')
          // Links
          .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color:#60a5fa;text-decoration:none;">$1</a>')
          // Line breaks
          .replace(/\n\n/g, '</p><p style="margin:12px 0;line-height:1.6;">')
          // Emoji/badge styling for ratings
          .replace(/â­/g, '<span style="color:#fbbf24;">â­</span>')
          .replace(/âœ…/g, '<span style="color:#4ade80;">âœ…</span>')
          .replace(/âŒ/g, '<span style="color:#f87171;">âŒ</span>')
          .replace(/ðŸ†/g, '<span style="font-size:18px;">ðŸ†</span>');
        // Wrap in paragraph
        html = '<p style="margin:12px 0;line-height:1.6;">' + html + '</p>';
        document.getElementById('docContent').innerHTML = html;
        document.getElementById('docViewer').style.display = 'block';
      } catch (e) {
        document.getElementById('docViewerTitle').textContent = docPath;
        document.getElementById('docContent').innerHTML = 'âš ï¸ Could not load document. Make sure docs are synced to the docs/ folder.';
        document.getElementById('docViewer').style.display = 'block';
      }
    }

    function closeDocViewer() {
      document.getElementById('docViewer').style.display = 'none';
    }

    // Search functions
    function handleSearch(query) {
      if (!data || !query.trim()) {
        document.getElementById('searchResults').innerHTML = '';
        document.getElementById('searchResults').classList.remove('active');
        return;
      }

      const q = query.toLowerCase();
      const results = [];

      // Search projects
      data.items.filter(i => i.type === 'project').forEach(item => {
        if (item.title.toLowerCase().includes(q) || item.description.toLowerCase().includes(q)) {
          results.push({ title: item.title, type: 'Project', status: item.status });
        }
      });

      // Search tasks
      data.items.filter(i => i.type === 'task').forEach(item => {
        if (item.title.toLowerCase().includes(q)) {
          results.push({ title: item.title, type: 'Task', status: item.status });
        }
      });

      // Search ideas
      data.items.filter(i => i.status === 'idea').forEach(item => {
        if (item.title.toLowerCase().includes(q) || item.description.toLowerCase().includes(q)) {
          results.push({ title: item.title, type: 'Idea', status: 'idea' });
        }
      });

      // Search tools
      if (data.tools) {
        data.tools.forEach(tool => {
          if (tool.name.toLowerCase().includes(q) || tool.description.toLowerCase().includes(q)) {
            results.push({ title: tool.name, type: 'Tool', status: tool.status });
          }
        });
      }

      // Search crons
      if (data.crons) {
        data.crons.forEach(cron => {
          if (cron.name.toLowerCase().includes(q) || (cron.desc || '').toLowerCase().includes(q)) {
            results.push({ title: cron.name, type: 'Cron Job', status: cron.enabled ? 'active' : 'inactive' });
          }
        });
      }

      // Render results
      const resultsEl = document.getElementById('searchResults');
      if (results.length > 0) {
        resultsEl.innerHTML = results.slice(0, 8).map(r => `
          <div class="search-result-item">
            <div class="title">${r.title}</div>
            <div class="type">${r.type} â€¢ ${r.status}</div>
          </div>
        `).join('');
        resultsEl.classList.add('active');
      } else {
        resultsEl.innerHTML = '<div class="search-result-item"><div class="title">No results found</div></div>';
        resultsEl.classList.add('active');
      }
    }

    function showSearchResults() {
      const query = document.getElementById('searchInput').value;
      if (query.trim()) {
        document.getElementById('searchResults').classList.add('active');
      }
    }

    function hideSearchResults() {
      document.getElementById('searchResults').classList.remove('active');
    }

    // Auto-refresh
    setInterval(loadData, 30000);
    setInterval(loadTasks, 30000);
    loadData();
    loadTasks();

    // Edit Modal Functions
    let currentEditId = null;
    let localEdits = JSON.parse(localStorage.getItem('missionControlEdits') || '{}');

    function openEditModal(id, title, status, progress) {
      currentEditId = id;
      document.getElementById('editModalTitle').textContent = 'Edit: ' + title;
      document.getElementById('editStatus').value = status || 'active';
      document.getElementById('editProgress').value = progress || 0;
      document.getElementById('editProgressValue').textContent = (progress || 0) + '%';
      document.getElementById('editNotes').value = localEdits[id]?.notes || '';
      document.getElementById('editModal').style.display = 'flex';
    }

    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
      currentEditId = null;
    }

    function saveEdit() {
      if (!currentEditId) return;
      
      const status = document.getElementById('editStatus').value;
      const progress = parseInt(document.getElementById('editProgress').value);
      const notes = document.getElementById('editNotes').value;
      
      localEdits[currentEditId] = {
        status: status,
        progress: progress,
        notes: notes,
        updatedAt: new Date().toISOString()
      };
      
      localStorage.setItem('missionControlEdits', JSON.stringify(localEdits));
      closeEditModal();
      render();
      
      // Show confirmation
      showToast('Changes saved locally');
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.style.cssText = 'position: fixed; bottom: 20px; right: 20px; background: #1a3d2a; color: #4ade80; padding: 12px 20px; border-radius: 8px; font-size: 14px; z-index: 2000;';
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function applyLocalEdits(item) {
      if (localEdits[item.id]) {
        return { ...item, ...localEdits[item.id] };
      }
      return item;
    }

    // Update progress slider label
    document.getElementById('editProgress').addEventListener('input', function() {
      document.getElementById('editProgressValue').textContent = this.value + '%';
    });

    // Daily Logs
    let dailyLogFiles = [];

    async function loadDailyLogManifest() {
      try {
        const response = await fetch('daily-logs/manifest.txt?' + Date.now());
        const text = await response.text();
        dailyLogFiles = text.trim().split('\n').filter(f => f.length > 0);
        renderDailyLogsList();
      } catch (e) {
        console.error('Failed to load daily logs manifest:', e);
      }
    }

    function formatLogDate(dateStr) {
      const date = new Date(dateStr + 'T12:00:00');
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      return {
        day: days[date.getDay()],
        full: `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`
      };
    }

    // Trading Notes functionality moved to unified Notes system

    function renderDailyLogsList() {
      document.getElementById('navDailyLogs').textContent = dailyLogFiles.length;
      
      const listHtml = dailyLogFiles.map((dateStr, i) => {
        const fmt = formatLogDate(dateStr);
        return `
          <div class="daily-log-item ${i === 0 ? 'active' : ''}" data-date="${dateStr}" onclick="loadDailyLog('${dateStr}')">
            <div class="day">${fmt.day}</div>
            <div class="date">${fmt.full}</div>
          </div>
        `;
      }).join('');
      
      document.getElementById('dailyLogsList').innerHTML = listHtml;
      
      // Load most recent by default
      if (dailyLogFiles.length > 0) {
        loadDailyLog(dailyLogFiles[0]);
      }
    }

    async function loadDailyLog(dateStr) {
      // Update active state
      document.querySelectorAll('.daily-log-item').forEach(el => {
        el.classList.toggle('active', el.dataset.date === dateStr);
      });

      const fmt = formatLogDate(dateStr);
      document.getElementById('dailyLogHeader').innerHTML = `
        <span class="daily-log-date">${fmt.day}, ${fmt.full}</span>
      `;

      try {
        const response = await fetch(`daily-logs/${dateStr}.md?` + Date.now());
        if (!response.ok) throw new Error('Not found');
        const markdown = await response.text();
        document.getElementById('dailyLogBody').innerHTML = renderMarkdown(markdown);
      } catch (e) {
        document.getElementById('dailyLogBody').innerHTML = `
          <p style="color: #666; padding: 40px; text-align: center;">No log found for this date</p>
        `;
      }
    }

    function renderMarkdown(md) {
      // Simple markdown renderer
      let html = md
        // Code blocks
        .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>')
        // Inline code
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        // Headers
        .replace(/^### (.*)$/gm, '<h3>$1</h3>')
        .replace(/^## (.*)$/gm, '<h2>$1</h2>')
        .replace(/^# (.*)$/gm, '<h1>$1</h1>')
        // Bold
        .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
        // Italic
        .replace(/\*([^*]+)\*/g, '<em>$1</em>')
        // Links
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
        // Blockquotes
        .replace(/^> (.*)$/gm, '<blockquote>$1</blockquote>')
        // Unordered lists
        .replace(/^- (.*)$/gm, '<li>$1</li>')
        // Horizontal rules
        .replace(/^---$/gm, '<hr>')
        // Paragraphs (double newlines)
        .replace(/\n\n/g, '</p><p>')
        // Single newlines in lists become nothing
        .replace(/<\/li>\n<li>/g, '</li><li>');

      // Wrap consecutive li tags in ul
      html = html.replace(/(<li>.*?<\/li>)+/gs, '<ul>$&</ul>');
      
      // Clean up empty paragraphs
      html = html.replace(/<p><\/p>/g, '');
      
      // Wrap in paragraph if not already structured
      if (!html.startsWith('<')) {
        html = '<p>' + html + '</p>';
      }

      return html;
    }

    // Skills data - Complete list with Lucide icons
    const skillsData = {
      active: [
        // Custom installed skills (~/clawd/skills/)
        { name: "api-monitor", icon: "activity", description: "Health check dashboard for all APIs with auto-recovery and Discord alerts. Prevents silent failures.", apis: ["All APIs"], usage: "python3 scripts/check.py --recover", category: "Custom" },
        { name: "earnings-scanner", icon: "bar-chart-3", description: "Scan upcoming earnings for stocks with weekly options. Shows bid/ask spreads, volume, and open interest.", apis: ["Schwab API", "Alpha Vantage"], usage: "python3 scripts/scan.py", category: "Custom" },
        { name: "earnings-research", icon: "search", description: "Complete pre-earnings research: sentiment + options + transcripts + fundamentals. Estimize crowd estimates.", apis: ["Schwab", "X API", "Web"], usage: "Full/transcript/crowd modes", category: "Custom" },
        { name: "schwab-trader", icon: "trending-up", description: "Schwab API for market data, quotes, options chains, expected moves. Auto token refresh.", apis: ["Schwab API"], usage: "OAuth + API calls", category: "Custom" },
        { name: "sentiment-scanner", icon: "radio", description: "All-in-one social/market sentiment: X + StockTwits + news. Whale tracking, pulse, alerts.", apis: ["X API", "Web"], usage: "stock/monitor/alert modes", category: "Custom" },
        { name: "oura-insights", icon: "heart", description: "Deep health analysis using Oura Ring data. Sleep quality, HRV trends, recovery patterns.", apis: ["Oura API"], usage: "Analyze sleep/health", category: "Custom" },
        { name: "marriott-scanner", icon: "building-2", description: "Generate Marriott booking links with MMP discount code. 80+ hotels across 9 cities.", apis: ["None"], usage: "--city 'Dubai' --months 'Feb,Mar'", category: "Custom" },
        { name: "youtube-transcript", icon: "youtube", description: "Extract transcripts from YouTube videos for summarization and analysis.", apis: ["YouTube"], usage: "Paste YouTube URL", category: "Custom" },
        { name: "design-audit", icon: "palette", description: "Premium UI/UX auditor with Steve Jobs philosophy. Screen-by-screen audit with phased plans.", apis: ["None"], usage: "Audit app designs", category: "Custom" },
        // Built-in active
        { name: "github", icon: "github", description: "Interact with GitHub using the gh CLI. Manage issues, PRs, CI runs, and API queries.", apis: ["GitHub CLI"], usage: "gh issue, gh pr", category: "Built-in" },
        { name: "weather", icon: "cloud-sun", description: "Get current weather and forecasts. No API key required.", apis: ["wttr.in"], usage: "Ask about weather", category: "Built-in" },
        { name: "gog", icon: "mail", description: "Google Workspace CLI for Gmail, Calendar, Drive, Contacts, Sheets, and Docs.", apis: ["Google OAuth"], usage: "gog mail, gog cal", category: "Built-in" },
        { name: "coding-agent", icon: "bot", description: "Run Codex CLI, Claude Code, OpenCode via background process.", apis: ["Various"], usage: "Background process control", category: "Built-in" },
        { name: "healthcheck", icon: "shield", description: "Host security hardening and risk-tolerance config for OpenClaw deployments.", apis: ["Local"], usage: "Security audits", category: "Built-in" },
      ],
      available: [
        // Productivity
        { name: "notion", icon: "book-open", description: "Notion API for creating and managing pages, databases, and blocks.", apis: ["Notion API"], usage: "Requires setup", category: "Productivity" },
        { name: "obsidian", icon: "vault", description: "Work with Obsidian vaults (plain Markdown) and automate via obsidian-cli.", apis: ["Local files"], usage: "obsidian-cli", category: "Productivity" },
        { name: "apple-reminders", icon: "check-square", description: "Manage Apple Reminders via remindctl CLI. Lists, dates, complete/delete.", apis: ["macOS local"], usage: "remindctl", category: "Productivity" },
        { name: "things-mac", icon: "list-checks", description: "Manage Things 3 via CLI. Add projects/todos, list inbox/today/upcoming.", apis: ["Things URL scheme"], usage: "things CLI", category: "Productivity" },
        { name: "bear-notes", icon: "file-text", description: "Create, search, and manage Bear notes via grizzly CLI.", apis: ["Bear app"], usage: "grizzly CLI", category: "Productivity" },
        { name: "trello", icon: "layout-grid", description: "Manage Trello boards, lists, and cards via REST API.", apis: ["Trello API"], usage: "Trello operations", category: "Productivity" },
        // Communication
        { name: "slack", icon: "hash", description: "Control Slack - send messages, react, pin, manage channels, moderation.", apis: ["Slack API"], usage: "slack tool", category: "Communication" },
        { name: "discord", icon: "gamepad-2", description: "Control Discord - messages, reactions, stickers, polls, threads, channels.", apis: ["Discord API"], usage: "discord tool", category: "Communication" },
        { name: "imsg", icon: "message-circle", description: "iMessage/SMS CLI for listing chats, history, watch, and sending.", apis: ["macOS local"], usage: "imsg CLI", category: "Communication" },
        { name: "wacli", icon: "smartphone", description: "Send WhatsApp messages and search/sync WhatsApp history.", apis: ["WhatsApp"], usage: "wacli CLI", category: "Communication" },
        { name: "himalaya", icon: "inbox", description: "CLI to manage emails via IMAP/SMTP. List, read, write, reply, forward, search.", apis: ["IMAP/SMTP"], usage: "himalaya CLI", category: "Communication" },
        { name: "bluebubbles", icon: "message-square", description: "BlueBubbles external channel plugin for Clawdbot.", apis: ["BlueBubbles"], usage: "Extension", category: "Communication" },
        // Media & Audio
        { name: "sag", icon: "volume-2", description: "ElevenLabs text-to-speech with mac-style say UX.", apis: ["ElevenLabs"], usage: "sag 'text'", category: "Media" },
        { name: "openai-whisper", icon: "mic", description: "Local speech-to-text with Whisper CLI (no API key).", apis: ["Local Whisper"], usage: "whisper CLI", category: "Media" },
        { name: "openai-whisper-api", icon: "mic-2", description: "Transcribe audio via OpenAI Audio Transcriptions API.", apis: ["OpenAI API"], usage: "API transcription", category: "Media" },
        { name: "sherpa-onnx-tts", icon: "audio-lines", description: "Local text-to-speech via sherpa-onnx (offline, no cloud).", apis: ["Local"], usage: "Offline TTS", category: "Media" },
        { name: "spotify-player", icon: "music", description: "Terminal Spotify playback/search via spogo.", apis: ["Spotify"], usage: "spogo CLI", category: "Media" },
        { name: "songsee", icon: "activity", description: "Generate spectrograms and visualizations from audio.", apis: ["Local"], usage: "songsee CLI", category: "Media" },
        { name: "voice-call", icon: "phone", description: "Start voice calls via Clawdbot voice-call plugin.", apis: ["Voice"], usage: "Voice calls", category: "Media" },
        { name: "gifgrep", icon: "image", description: "Search GIF providers, download results, extract stills.", apis: ["GIF APIs"], usage: "gifgrep CLI", category: "Media" },
        // AI & Images
        { name: "nano-banana-pro", icon: "sparkles", description: "Generate or edit images via Gemini 3 Pro Image.", apis: ["Gemini API"], usage: "Image generation", category: "AI" },
        { name: "openai-image-gen", icon: "image-plus", description: "Batch-generate images via OpenAI Images API.", apis: ["OpenAI API"], usage: "Image batch", category: "AI" },
        { name: "gemini", icon: "brain", description: "Gemini CLI for one-shot Q&A, summaries, and generation.", apis: ["Gemini API"], usage: "gemini CLI", category: "AI" },
        { name: "oracle", icon: "wand-2", description: "Prompt + file bundling, engines, sessions, file attachments.", apis: ["Various"], usage: "oracle CLI", category: "AI" },
        { name: "summarize", icon: "file-text", description: "Summarize or extract text from URLs, podcasts, local files.", apis: ["Various"], usage: "summarize URL", category: "AI" },
        // Smart Home
        { name: "openhue", icon: "lightbulb", description: "Control Philips Hue lights/scenes via OpenHue CLI.", apis: ["Hue Bridge"], usage: "openhue CLI", category: "Smart Home" },
        { name: "sonoscli", icon: "speaker", description: "Control Sonos speakers - discover, status, play, volume, group.", apis: ["Sonos local"], usage: "sonoscli", category: "Smart Home" },
        { name: "blucli", icon: "radio", description: "BluOS CLI for discovery, playback, grouping, and volume.", apis: ["BluOS"], usage: "blu CLI", category: "Smart Home" },
        { name: "eightctl", icon: "bed", description: "Control Eight Sleep pods - status, temperature, alarms, schedules.", apis: ["Eight Sleep"], usage: "eightctl", category: "Smart Home" },
        // Cameras & Automation
        { name: "camsnap", icon: "camera", description: "Capture frames or clips from RTSP/ONVIF cameras.", apis: ["RTSP/ONVIF"], usage: "camsnap", category: "Automation" },
        { name: "peekaboo", icon: "eye", description: "Capture and automate macOS UI with Peekaboo CLI.", apis: ["macOS"], usage: "peekaboo", category: "Automation" },
        { name: "tmux", icon: "terminal", description: "Remote-control tmux sessions - send keystrokes, scrape output.", apis: ["tmux"], usage: "tmux control", category: "Automation" },
        // Documents & Files
        { name: "nano-pdf", icon: "file-type", description: "Edit PDFs with natural-language instructions.", apis: ["Local"], usage: "nano-pdf CLI", category: "Documents" },
        // Security
        { name: "1password", icon: "key-round", description: "Set up and use 1Password CLI. Read/inject/run secrets.", apis: ["1Password CLI"], usage: "op CLI", category: "Security" },
        // Food & Places
        { name: "food-order", icon: "utensils", description: "Reorder Foodora orders + track ETA/status.", apis: ["Foodora"], usage: "ordercli", category: "Lifestyle" },
        { name: "goplaces", icon: "map-pin", description: "Query Google Places API for search, details, reviews.", apis: ["Google Places"], usage: "goplaces CLI", category: "Lifestyle" },
        { name: "local-places", icon: "map", description: "Search for places via Google Places API proxy.", apis: ["Google Places"], usage: "Local proxy", category: "Lifestyle" },
        // Social
        { name: "bird", icon: "twitter", description: "X/Twitter CLI for reading, searching, posting, engagement.", apis: ["X cookies"], usage: "bird CLI", category: "Social" },
        { name: "blogwatcher", icon: "rss", description: "Monitor blogs and RSS/Atom feeds for updates.", apis: ["RSS/Atom"], usage: "blogwatcher", category: "Social" },
        // Misc
        { name: "canvas", icon: "presentation", description: "Canvas control for presentations.", apis: ["Canvas"], usage: "canvas tool", category: "Misc" },
        { name: "mcporter", icon: "plug", description: "List, configure, auth, and call MCP servers/tools.", apis: ["MCP"], usage: "mcporter CLI", category: "Misc" },
        { name: "model-usage", icon: "line-chart", description: "Summarize per-model usage/cost from CodexBar.", apis: ["CodexBar"], usage: "codexbar cost", category: "Misc" },
        { name: "session-logs", icon: "scroll", description: "Search and analyze your own session logs using jq.", apis: ["Local"], usage: "jq queries", category: "Misc" },
        { name: "ordercli", icon: "bike", description: "Foodora-only CLI for checking past orders and status.", apis: ["Foodora"], usage: "ordercli", category: "Misc" },
      ]
    };

    function renderSkills() {
      const totalSkills = skillsData.active.length + skillsData.available.length;
      document.getElementById('navSkills').textContent = totalSkills;

      // Render active skills
      document.getElementById('activeSkillsGrid').innerHTML = skillsData.active.map(skill => `
        <div class="skill-card">
          <div class="skill-card-header">
            <div class="skill-card-title">
              <div class="skill-icon active"><i data-lucide="${skill.icon}"></i></div>
              <h3>${skill.name}</h3>
            </div>
            <div style="display: flex; gap: 6px; align-items: center;">
              <span class="skill-meta-tag" style="background: #1a2a1a; color: #6b8">${skill.category}</span>
              <span class="skill-card-status active">Active</span>
            </div>
          </div>
          <div class="skill-card-desc">${skill.description}</div>
          <div class="skill-card-meta">
            ${skill.apis.map(api => `<span class="skill-meta-tag api">${api}</span>`).join('')}
          </div>
          <div class="skill-card-usage">
            <code>${skill.usage}</code>
          </div>
        </div>
      `).join('');

      // Group available skills by category
      const categories = {};
      skillsData.available.forEach(skill => {
        if (!categories[skill.category]) categories[skill.category] = [];
        categories[skill.category].push(skill);
      });

      // Render available skills grouped by category
      let availableHtml = '';
      Object.keys(categories).sort().forEach(cat => {
        availableHtml += `<div style="grid-column: 1 / -1; margin-top: 16px; margin-bottom: 8px;"><span style="font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px;">${cat}</span></div>`;
        categories[cat].forEach(skill => {
          availableHtml += `
            <div class="skill-card">
              <div class="skill-card-header">
                <div class="skill-card-title">
                  <div class="skill-icon"><i data-lucide="${skill.icon}"></i></div>
                  <h3>${skill.name}</h3>
                </div>
                <span class="skill-card-status available">Available</span>
              </div>
              <div class="skill-card-desc">${skill.description}</div>
              <div class="skill-card-meta">
                ${skill.apis.map(api => `<span class="skill-meta-tag api">${api}</span>`).join('')}
              </div>
              <div class="skill-card-usage">
                <code>${skill.usage}</code>
              </div>
            </div>
          `;
        });
      });
      document.getElementById('availableSkillsGrid').innerHTML = availableHtml;

      // Render active skills list view
      document.getElementById('activeSkillsList').innerHTML = skillsData.active.map(skill => `
        <div class="skill-row">
          <div class="skill-row-icon active"><i data-lucide="${skill.icon}"></i></div>
          <span class="skill-row-name">${skill.name}</span>
          <span class="skill-row-desc">${skill.description}</span>
          <div class="skill-row-tags">
            ${skill.apis.map(api => `<span class="skill-meta-tag api">${api}</span>`).join('')}
          </div>
          <span class="skill-row-status active">Active</span>
        </div>
      `).join('');

      // Render available skills list view
      let availableListHtml = '';
      Object.keys(categories).sort().forEach(cat => {
        availableListHtml += `<div style="margin-top: 16px; margin-bottom: 8px;"><span style="font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px;">${cat}</span></div>`;
        categories[cat].forEach(skill => {
          availableListHtml += `
            <div class="skill-row">
              <div class="skill-row-icon"><i data-lucide="${skill.icon}"></i></div>
              <span class="skill-row-name">${skill.name}</span>
              <span class="skill-row-desc">${skill.description}</span>
              <div class="skill-row-tags">
                ${skill.apis.map(api => `<span class="skill-meta-tag api">${api}</span>`).join('')}
              </div>
              <span class="skill-row-status available">Available</span>
            </div>
          `;
        });
      });
      document.getElementById('availableSkillsList').innerHTML = availableListHtml;
      
      // Re-initialize Lucide icons for the new content
      lucide.createIcons();
    }

    // Toggle skills view between grid and list
    function setSkillsView(view) {
      const gridBtn = document.getElementById('gridViewBtn');
      const listBtn = document.getElementById('listViewBtn');
      const activeGrid = document.getElementById('activeSkillsGrid');
      const activeList = document.getElementById('activeSkillsList');
      const availableGrid = document.getElementById('availableSkillsGrid');
      const availableList = document.getElementById('availableSkillsList');

      if (view === 'grid') {
        gridBtn.classList.add('active');
        listBtn.classList.remove('active');
        activeGrid.style.display = 'grid';
        activeList.style.display = 'none';
        availableGrid.style.display = 'grid';
        availableList.style.display = 'none';
      } else {
        gridBtn.classList.remove('active');
        listBtn.classList.add('active');
        activeGrid.style.display = 'none';
        activeList.style.display = 'flex';
        availableGrid.style.display = 'none';
        availableList.style.display = 'flex';
      }
      lucide.createIcons();
    }

    // Initialize skills count on load
    document.getElementById('navSkills').textContent = skillsData.active.length + skillsData.available.length;

    // Org Chart Functions
    function renderOrgChart() {
      const orgData = {
        ceo: {
          name: 'Nam',
          title: 'CEO & Founder',
          icon: 'user-circle',
          status: 'ceo',
          model: null,
          role: 'Visionary leader and strategic direction'
        },
        team: [
          {
            name: 'Alfred',
            title: 'COO (Operations & Intelligence)',
            icon: 'bot',
            status: 'active',
            model: 'Claude Opus 4.6',
            role: 'Ops orchestration, health monitoring, daily briefs, memory management, system maintenance',
            owns: '22 cron jobs',
            key: 'Oura briefings, email, night shift, daily ideas, thread archiver'
          },
          {
            name: 'Sentinel',
            title: 'CTO Trading (Market Intelligence)',
            icon: 'target',
            status: 'active',
            model: 'Claude Opus 4.6',
            role: 'Trading analysis, earnings pipeline, sentiment, market scans',
            owns: '26 cron jobs',
            key: 'Earnings scanner, spread rankings, social arb, EOD recaps'
          },
          {
            name: 'Concierge',
            title: 'Chief of Staff (Lifestyle & Travel)',
            icon: 'concierge-bell',
            status: 'planned',
            model: null,
            role: 'Travel booking, restaurants, hotels, personal logistics',
            owns: 'Marriott scanner, flight tracking, hotel reminders'
          },
          {
            name: 'Builder',
            title: 'CTO Engineering (Apps & Infrastructure)',
            icon: 'hammer',
            status: 'planned',
            model: null,
            role: 'Build and maintain all apps, CLI tools, deployments',
            owns: 'Mission Control, Earnings Tracker, Convex, Vercel'
          },
          {
            name: 'Analyst',
            title: 'VP Research (Deep Dives & Due Diligence)',
            icon: 'search',
            status: 'planned',
            model: null,
            role: 'Earnings research, company analysis, macro trends, thesis validation',
            owns: 'Earnings research skill, YouTube transcripts, sentiment deep dives'
          }
        ]
      };

      const container = document.getElementById('orgChartContainer');
      
      const ceoCard = createOrgCard(orgData.ceo, true);
      
      const teamCards = orgData.team.map(member => createOrgCard(member, false)).join('');
      
      container.innerHTML = `
        <div class="org-tree">
          <div class="org-node">
            ${ceoCard}
          </div>
          <div class="org-children">
            ${orgData.team.map(member => `
              <div class="org-node">
                ${createOrgCard(member, false)}
              </div>
            `).join('')}
          </div>
        </div>
      `;
      
      // Add click handlers for expand/collapse
      container.querySelectorAll('.org-card').forEach(card => {
        card.addEventListener('click', () => {
          card.classList.toggle('expanded');
        });
      });
      
      // Re-initialize Lucide icons
      lucide.createIcons();
    }

    function createOrgCard(member, isCEO) {
      const statusBadge = member.status === 'active' 
        ? `<span class="org-status active">ðŸŸ¢ Active</span>`
        : member.status === 'planned'
        ? `<span class="org-status planned">ðŸ”® Planned</span>`
        : '';
      
      const modelBadge = member.model 
        ? `<span class="org-model">${member.model}</span>`
        : '';
      
      const hireButton = member.status === 'planned' 
        ? `<button class="hire-btn" onclick="event.stopPropagation()">
             Hire
             <div class="hire-tooltip">Coming soon</div>
           </button>`
        : '';
      
      return `
        <div class="org-card ${member.status}" onclick="toggleOrgCard(this)">
          <div class="org-card-header">
            <div class="org-icon">
              <i data-lucide="${member.icon}"></i>
            </div>
            <div style="flex: 1;">
              <div class="org-name">${member.name}${modelBadge}</div>
              <div class="org-title">${member.title}</div>
            </div>
            ${statusBadge}
          </div>
          <div class="org-details">
            <div class="org-detail-row">
              <span class="org-detail-label">Role:</span>
              <span class="org-detail-value">${member.role}</span>
            </div>
            ${member.owns ? `
              <div class="org-detail-row">
                <span class="org-detail-label">Owns:</span>
                <span class="org-detail-value org-crons">${member.owns}</span>
              </div>
            ` : ''}
            ${member.key ? `
              <div class="org-detail-row">
                <span class="org-detail-label">Key:</span>
                <span class="org-detail-value">${member.key}</span>
              </div>
            ` : ''}
          </div>
          ${hireButton}
        </div>
      `;
    }

    function toggleOrgCard(card) {
      card.classList.toggle('expanded');
    }

    // Update local time for Nam's location
    function updateLocalTime(tz) {
      const tzMap = {
        'HKT (UTC+8)': 'Asia/Hong_Kong',
        'GST (UTC+4)': 'Asia/Dubai',
        'PST': 'America/Los_Angeles',
        'PT': 'America/Los_Angeles'
      };
      
      const timezone = tzMap[tz] || 'Asia/Hong_Kong';
      
      function tick() {
        const now = new Date();
        const options = { timeZone: timezone, hour: '2-digit', minute: '2-digit', hour12: false };
        const timeStr = now.toLocaleTimeString('en-US', options);
        document.getElementById('localTimeNow').textContent = timeStr;
      }
      
      tick();
      setInterval(tick, 1000);
    }

    // Notes System
    let currentNotesTab = 'general';
    let generalNotesFiles = [];
    let tradingNotesFiles = [];
    
    async function renderNotes() {
      // Initialize tab buttons
      document.querySelectorAll('.notes-tab-btn').forEach(btn => {
        btn.addEventListener('click', () => switchNotesTab(btn.dataset.tab));
      });
      
      // Load initial data and render
      await loadNotesData();
      switchNotesTab('general');
    }
    
    async function loadNotesData() {
      // Load general notes
      try {
        const resp = await fetch('notes/general/manifest.txt?' + Date.now());
        const text = await resp.text();
        generalNotesFiles = text.trim().split('\n').filter(Boolean);
      } catch(e) {
        generalNotesFiles = [];
      }
      
      // Load trading notes
      try {
        const resp = await fetch('notes/manifest.txt?' + Date.now());
        const text = await resp.text();
        tradingNotesFiles = text.trim().split('\n').filter(Boolean);
      } catch(e) {
        tradingNotesFiles = [];
      }
    }
    
    function switchNotesTab(tab) {
      currentNotesTab = tab;
      
      // Update tab buttons
      document.querySelectorAll('.notes-tab-btn').forEach(btn => {
        if (btn.dataset.tab === tab) {
          btn.style.background = '#232323';
          btn.style.color = '#ccc';
        } else {
          btn.style.background = 'transparent';
          btn.style.color = '#888';
        }
      });
      
      // Render content based on tab
      switch(tab) {
        case 'general':
          renderGeneralNotes();
          break;
        case 'trading':
          renderTradingNotesTab();
          break;
        case 'reminders':
          renderReminders();
          break;
        case 'ideas':
          renderIdeasTab();
          break;
      }
    }
    
    function renderGeneralNotes() {
      document.getElementById('notesHeader').innerHTML = `<span class="daily-log-date">ðŸ“ General Notes</span>`;
      
      if (generalNotesFiles.length === 0) {
        document.getElementById('notesList').innerHTML = '<p style="color:#666;padding:16px;">No notes found</p>';
        document.getElementById('notesBody').innerHTML = '<p style="color: #666; padding: 40px; text-align: center;">No general notes available</p>';
        return;
      }
      
      document.getElementById('notesList').innerHTML = generalNotesFiles.map(f => 
        `<div class="daily-log-item" onclick="loadGeneralNote('${f}')" style="cursor:pointer;padding:10px 12px;border-bottom:1px solid #1a1a1a;font-size:13px;color:#ccc;transition:background .2s;" onmouseover="this.style.background='#1a1a1a'" onmouseout="this.style.background='transparent'">
          <span style="color:#4ade80;margin-right:6px;">ðŸ“</span>${f.replace(/-/g, ' ')}
        </div>`
      ).join('');
      
      // Load first note by default
      if (generalNotesFiles.length > 0) {
        loadGeneralNote(generalNotesFiles[0]);
      }
    }
    
    async function loadGeneralNote(noteFile) {
      try {
        const resp = await fetch(`notes/general/${noteFile}.md?` + Date.now());
        const md = await resp.text();
        document.getElementById('notesHeader').innerHTML = `<span class="daily-log-date">ðŸ“ ${noteFile.replace(/-/g, ' ')}</span>`;
        document.getElementById('notesBody').innerHTML = renderMarkdown(md);
        
        // Highlight active item
        document.querySelectorAll('#notesList .daily-log-item').forEach(el => el.style.background = 'transparent');
        event.currentTarget.style.background = '#1a1a1a';
      } catch(e) {
        document.getElementById('notesBody').innerHTML = '<p style="color:#666;padding:40px;text-align:center;">Could not load note</p>';
      }
    }
    
    function renderTradingNotesTab() {
      document.getElementById('notesHeader').innerHTML = `<span class="daily-log-date">ðŸ“ˆ Trading Notes</span>`;
      
      if (tradingNotesFiles.length === 0) {
        document.getElementById('notesList').innerHTML = '<p style="color:#666;padding:16px;">No trading notes found</p>';
        document.getElementById('notesBody').innerHTML = '<p style="color: #666; padding: 40px; text-align: center;">No trading notes available</p>';
        return;
      }
      
      document.getElementById('notesList').innerHTML = tradingNotesFiles.map(t => 
        `<div class="daily-log-item" onclick="loadTradingNoteInTab('${t}')" style="cursor:pointer;padding:10px 12px;border-bottom:1px solid #1a1a1a;font-family:'SF Mono',monospace;font-size:13px;color:#ccc;transition:background .2s;" onmouseover="this.style.background='#1a1a1a'" onmouseout="this.style.background='transparent'">
          <span style="color:#4ade80;margin-right:6px;">$</span>${t}
        </div>`
      ).join('');
      
      document.getElementById('notesBody').innerHTML = '<p style="color: #666; padding: 40px; text-align: center;">â† Choose a ticker to view notes</p>';
    }
    
    async function loadTradingNoteInTab(ticker) {
      try {
        const resp = await fetch(`notes/${ticker}.md?` + Date.now());
        const md = await resp.text();
        document.getElementById('notesHeader').innerHTML = `<span class="daily-log-date" style="color:#4ade80;">$${ticker}</span>`;
        document.getElementById('notesBody').innerHTML = renderMarkdown(md);
        
        // Highlight active item
        document.querySelectorAll('#notesList .daily-log-item').forEach(el => el.style.background = 'transparent');
        event.currentTarget.style.background = '#1a1a1a';
      } catch(e) {
        document.getElementById('notesBody').innerHTML = '<p style="color:#666;padding:40px;text-align:center;">Could not load note</p>';
      }
    }
    
    function renderReminders() {
      document.getElementById('notesHeader').innerHTML = `<span class="daily-log-date">â° Reminders</span>`;
      document.getElementById('notesList').innerHTML = '';
      
      if (!data.crons) {
        document.getElementById('notesBody').innerHTML = '<p style="color: #666; padding: 40px; text-align: center;">No crons data available</p>';
        return;
      }
      
      const reminderCrons = ['jessica-hotel-reminder', 'estimize-trial-reminder', 'estimize-cancel-reminder', 'xapi-cancel-reminder', 'ortex-cancel-reminder', 'amzn-buy-reminder', 'duol-earnings-decision', 'flight-cancel-check', 'schwab-re-auth-reminder', 'subscription-review-monthly'];
      const reminders = data.crons.filter(c => reminderCrons.includes(c.name));
      
      if (reminders.length === 0) {
        document.getElementById('notesBody').innerHTML = '<p style="color: #666; padding: 40px; text-align: center;">No reminders found</p>';
        return;
      }
      
      const html = `
        <div style="padding: 20px;">
          <h3 style="color: #fff; margin-bottom: 16px;">Personal Reminders</h3>
          ${reminders.map(r => `
            <div style="padding: 12px 0; border-bottom: 1px solid #232323;">
              <div style="font-weight: 600; color: #e5e5e5; margin-bottom: 4px;">${r.name}</div>
              <div style="color: #999; font-size: 13px; margin-bottom: 6px;">${r.desc || 'No description'}</div>
              <div style="color: #666; font-size: 12px; font-family: monospace;">${r.schedule}</div>
              <div style="margin-top: 6px;">
                <span style="padding: 2px 8px; border-radius: 4px; font-size: 11px; ${r.enabled !== false ? 'background: #1a3d2a; color: #4ade80;' : 'background: #3d1a1a; color: #f87171;'}">${r.enabled !== false ? 'âœ“ Active' : 'âœ— Disabled'}</span>
              </div>
            </div>
          `).join('')}
        </div>
      `;
      
      document.getElementById('notesBody').innerHTML = html;
    }
    
    function renderIdeasTab() {
      document.getElementById('notesHeader').innerHTML = `<span class="daily-log-date">ðŸ’¡ Ideas</span>`;
      document.getElementById('notesList').innerHTML = '';
      
      const ideaItems = data.items.filter(i => i.status === 'idea');
      
      if (ideaItems.length === 0) {
        document.getElementById('notesBody').innerHTML = '<p style="color: #666; padding: 40px; text-align: center;">No ideas found</p>';
        return;
      }
      
      const html = `
        <div style="padding: 20px;">
          <h3 style="color: #fff; margin-bottom: 16px;">Ideas & Suggestions</h3>
          ${ideaItems.map(item => `
            <div style="padding: 16px; background: #161616; border: 1px solid #232323; border-radius: 8px; margin-bottom: 12px;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <span style="color: #a585d4;">ðŸ’¡</span>
                <div style="font-weight: 600; color: #e5e5e5;">${item.title}</div>
              </div>
              <div style="color: #999; line-height: 1.5; margin-bottom: 8px;">${item.description}</div>
              <div style="color: #666; font-size: 12px;">${formatDate(item.created)}</div>
            </div>
          `).join('')}
        </div>
      `;
      
      document.getElementById('notesBody').innerHTML = html;
    }

    // Projects Hub System
    let allProjects = [];
    let currentProject = null;
    
    async function renderProjectsHub() {
      // Load projects from Convex
      try {
        allProjects = await convexClient.query("projects:list");
        const hubCount = document.getElementById('navProjectsHub');
        if (hubCount) hubCount.textContent = allProjects.length;
      } catch (error) {
        console.error('Failed to load projects:', error);
        allProjects = [];
      }
      
      // Reset to list view
      document.getElementById('projectsListView').style.display = 'block';
      document.getElementById('projectDetailView').style.display = 'none';
      
      // Populate tag filter
      const allTags = new Set();
      allProjects.forEach(p => {
        if (p.tags) p.tags.forEach(tag => allTags.add(tag));
      });
      
      const tagFilter = document.getElementById('projectTagFilter');
      tagFilter.innerHTML = '<option value="">All Tags</option>' + 
        Array.from(allTags).sort().map(tag => `<option value="${tag}">${tag}</option>`).join('');
      
      // Setup event listeners
      document.getElementById('projectStatusFilter').addEventListener('change', filterProjects);
      document.getElementById('projectTagFilter').addEventListener('change', filterProjects);
      document.getElementById('projectSearchInput').addEventListener('input', filterProjects);
      document.getElementById('backToProjectsList').addEventListener('click', () => {
        document.getElementById('projectsListView').style.display = 'block';
        document.getElementById('projectDetailView').style.display = 'none';
      });
      
      // Render initial list
      renderProjectsList(allProjects);
    }
    
    function filterProjects() {
      const statusFilter = document.getElementById('projectStatusFilter').value;
      const tagFilter = document.getElementById('projectTagFilter').value;
      const searchQuery = document.getElementById('projectSearchInput').value.toLowerCase();
      
      let filtered = allProjects;
      
      if (statusFilter) {
        filtered = filtered.filter(p => p.status === statusFilter);
      }
      
      if (tagFilter) {
        filtered = filtered.filter(p => p.tags && p.tags.includes(tagFilter));
      }
      
      if (searchQuery) {
        filtered = filtered.filter(p => 
          p.title.toLowerCase().includes(searchQuery) ||
          (p.description && p.description.toLowerCase().includes(searchQuery))
        );
      }
      
      renderProjectsList(filtered);
    }
    
    function renderProjectsList(projects) {
      const grid = document.getElementById('projectsGrid');
      
      if (projects.length === 0) {
        grid.innerHTML = '<div style="grid-column: 1 / -1; padding: 40px; text-align: center; color: #666;">No projects found</div>';
        return;
      }
      
      // Sort: live â†’ building â†’ planning â†’ research â†’ paused â†’ archived
      const statusOrder = { live: 0, building: 1, planning: 2, research: 3, paused: 4, archived: 5 };
      projects = [...projects].sort((a, b) => (statusOrder[a.status] ?? 9) - (statusOrder[b.status] ?? 9));
      
      const statusColors = {
        live: '#4ade80',
        building: '#f59e0b',
        planning: '#3b82f6',
        paused: '#6b7280',
        research: '#a78bfa',
        archived: '#555'
      };
      
      grid.innerHTML = projects.map(project => {
        const statusColor = statusColors[project.status] || '#666';
        const tagHtml = project.tags ? project.tags.slice(0, 3).map(tag => 
          `<span style="background: #1a1a1a; color: #999; padding: 2px 8px; border-radius: 4px; font-size: 11px;">${tag}</span>`
        ).join('') : '';
        
        return `
          <div onclick="showProjectDetail('${project._id}')" style="background: #161616; border: 1px solid #232323; border-radius: 10px; padding: 20px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#333'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#232323'; this.style.transform='translateY(0)';">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
              <h3 style="color: #fff; font-size: 16px; font-weight: 600; margin: 0;">${project.title}</h3>
              <span style="padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 500; background: ${statusColor}22; color: ${statusColor}; text-transform: uppercase; white-space: nowrap;">${project.status}</span>
            </div>
            
            ${project.description ? `<p style="color: #999; font-size: 13px; line-height: 1.5; margin-bottom: 12px;">${project.description.substring(0, 100)}${project.description.length > 100 ? '...' : ''}</p>` : ''}
            
            <div style="display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px;">
              ${tagHtml}
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 12px; border-top: 1px solid #1a1a1a;">
              ${project.agent ? `<span style="color: #666; font-size: 12px;"><i data-lucide="user" style="width: 12px; height: 12px;"></i> ${project.agent}</span>` : '<span></span>'}
              ${project.progress !== undefined ? `<span style="color: #666; font-size: 12px;">${project.progress}% complete</span>` : ''}
            </div>
          </div>
        `;
      }).join('');
      
      lucide.createIcons();
    }
    
    async function showProjectDetail(projectId) {
      const project = allProjects.find(p => p._id === projectId);
      if (!project) return;
      
      currentProject = project;
      
      const statusColors = {
        live: '#4ade80',
        building: '#f59e0b',
        planning: '#3b82f6',
        paused: '#6b7280',
        research: '#a78bfa',
        archived: '#555'
      };
      const statusColor = statusColors[project.status] || '#666';
      
      const tagHtml = project.tags ? project.tags.map(tag => 
        `<span style="background: #1a1a1a; color: #999; padding: 4px 12px; border-radius: 4px; font-size: 12px;">${tag}</span>`
      ).join('') : '';
      
      const linksHtml = `
        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
          ${project.githubUrl ? `<a href="${project.githubUrl}" target="_blank" style="display: flex; align-items: center; gap: 6px; background: #2a2a3d; color: #8b8bf5; padding: 8px 14px; border-radius: 6px; text-decoration: none; font-size: 13px;"><i data-lucide="github" style="width: 16px; height: 16px;"></i> GitHub</a>` : ''}
          ${project.vercelUrl ? `<a href="${project.vercelUrl}" target="_blank" style="display: flex; align-items: center; gap: 6px; background: #1a3d2a; color: #4ade80; padding: 8px 14px; border-radius: 6px; text-decoration: none; font-size: 13px;"><i data-lucide="external-link" style="width: 16px; height: 16px;"></i> Live Site</a>` : ''}
          ${project.discordChannelId ? `<a href="https://discord.com/channels/1466625923578331291/${project.discordChannelId}" target="_blank" style="display: flex; align-items: center; gap: 6px; background: #3d2a3d; color: #c77dff; padding: 8px 14px; border-radius: 6px; text-decoration: none; font-size: 13px;"><i data-lucide="message-square" style="width: 16px; height: 16px;"></i> Discord</a>` : ''}
        </div>
      `;
      
      const html = `
        <div style="background: #161616; border: 1px solid #232323; border-radius: 10px; padding: 28px;">
          <!-- Header -->
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 24px;">
            <div>
              <h2 style="color: #fff; font-size: 24px; font-weight: 600; margin: 0 0 8px 0;">${project.title}</h2>
              <div style="display: flex; gap: 8px; align-items: center;">
                <span style="padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: 500; background: ${statusColor}22; color: ${statusColor}; text-transform: uppercase;">${project.status}</span>
                ${project.agent ? `<span style="color: #666; font-size: 14px;">â€¢ Managed by <span style="color: ${statusColor};">${project.agent}</span></span>` : ''}
              </div>
            </div>
            ${project.progress !== undefined ? `
              <div style="text-align: right;">
                <div style="color: #666; font-size: 12px; margin-bottom: 4px;">Progress</div>
                <div style="font-size: 24px; font-weight: 600; color: ${statusColor};">${project.progress}%</div>
              </div>
            ` : ''}
          </div>
          
          <!-- Description -->
          ${project.description ? `
            <div style="margin-bottom: 24px;">
              <p style="color: #ccc; font-size: 14px; line-height: 1.6;">${project.description}</p>
            </div>
          ` : ''}
          
          <!-- Links -->
          ${linksHtml ? `
            <div style="margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #1a1a1a;">
              <h4 style="color: #999; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Links</h4>
              ${linksHtml}
            </div>
          ` : ''}
          
          <!-- Tags -->
          ${project.tags && project.tags.length > 0 ? `
            <div style="margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #1a1a1a;">
              <h4 style="color: #999; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Tags</h4>
              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                ${tagHtml}
              </div>
            </div>
          ` : ''}
          
          <!-- Tech Stack -->
          ${project.techStack && project.techStack.length > 0 ? `
            <div style="margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #1a1a1a;">
              <h4 style="color: #999; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Tech Stack</h4>
              <div style="color: #ccc; font-size: 13px;">${project.techStack.join(' â€¢ ')}</div>
            </div>
          ` : ''}
          
          <!-- Features -->
          ${project.features && project.features.length > 0 ? `
            <div style="margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #1a1a1a;">
              <h4 style="color: #999; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Features</h4>
              <ul style="list-style: none; padding: 0; margin: 0;">
                ${project.features.map(f => `<li style="color: #ccc; font-size: 13px; padding: 4px 0; padding-left: 20px; position: relative;"><span style="position: absolute; left: 0; color: #4ade80;">âœ“</span>${f}</li>`).join('')}
              </ul>
            </div>
          ` : ''}
          
          <!-- APIs -->
          ${project.apis && project.apis.length > 0 ? `
            <div style="margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #1a1a1a;">
              <h4 style="color: #999; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">APIs Used</h4>
              <div style="color: #ccc; font-size: 13px;">${project.apis.join(' â€¢ ')}</div>
            </div>
          ` : ''}
          
          <!-- Documents -->
          ${project.brainFolder ? `
            <div id="projectDocuments">
              <h4 style="color: #999; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Documents</h4>
              <div id="projectFilesBreadcrumb" style="color: #666; font-size: 12px; margin-bottom: 12px;"></div>
              <div id="projectFilesList" style="background: #0d0d0d; border: 1px solid #1a1a1a; border-radius: 6px; padding: 12px;">
                <div style="color: #666; text-align: center; padding: 20px;">Loading...</div>
              </div>
              <div id="projectFileViewer" style="display: none; margin-top: 16px; background: #0d0d0d; border: 1px solid #1a1a1a; border-radius: 6px; padding: 20px;"></div>
            </div>
          ` : ''}
        </div>
      `;
      
      document.getElementById('projectDetailContent').innerHTML = html;
      document.getElementById('projectsListView').style.display = 'none';
      document.getElementById('projectDetailView').style.display = 'block';
      
      lucide.createIcons();
      
      // Load documents if brainFolder exists
      if (project.brainFolder) {
        loadProjectFiles(project.brainFolder);
      }
    }
    
    const FILE_API = 'http://localhost:3847';
    const FILE_TOKEN = '2f78dad1dad370ceed79b53620c59cbb7620d2818e53dc54';
    
    async function loadProjectFiles(folderPath, currentPath = '') {
      const fullPath = currentPath ? `${folderPath}/${currentPath}` : folderPath;
      
      // Build breadcrumb
      const parts = fullPath.split('/').filter(Boolean);
      let breadcrumb = `<span style="cursor:pointer;color:#4ade80;" onclick="loadProjectFiles('${folderPath}')">ðŸ“ ${folderPath}</span>`;
      if (currentPath) {
        const crumbs = currentPath.split('/').filter(Boolean);
        let accumulated = '';
        crumbs.forEach((part, i) => {
          accumulated += (accumulated ? '/' : '') + part;
          breadcrumb += ` / <span style="cursor:pointer;color:#4ade80;" onclick="loadProjectFiles('${folderPath}','${accumulated}')">${part}</span>`;
        });
      }
      document.getElementById('projectFilesBreadcrumb').innerHTML = breadcrumb;
      document.getElementById('projectFileViewer').style.display = 'none';
      
      try {
        const resp = await fetch(`${FILE_API}/api/files?path=${encodeURIComponent(fullPath)}`, {
          headers: { 'Authorization': `Bearer ${FILE_TOKEN}` }
        });
        if (!resp.ok) throw new Error('API error');
        const data = await resp.json();
        
        if (data.files.length === 0) {
          document.getElementById('projectFilesList').innerHTML = '<div style="color:#666;text-align:center;padding:20px;">Empty folder</div>';
          return;
        }
        
        document.getElementById('projectFilesList').innerHTML = data.files.map(f => {
          const icon = f.type === 'dir' ? 'folder' : 'file-text';
          const color = f.type === 'dir' ? '#f59e0b' : '#666';
          const size = f.type === 'file' ? `<span style="color:#555;font-size:11px;margin-left:auto;">${formatFileSize(f.size)}</span>` : '';
          const modified = `<span style="color:#444;font-size:11px;">${new Date(f.modified).toLocaleDateString()}</span>`;
          const onclick = f.type === 'dir' 
            ? `loadProjectFiles('${folderPath}','${currentPath ? currentPath + '/' : ''}${f.name}')`
            : `viewProjectFile('${folderPath}','${currentPath ? currentPath + '/' : ''}${f.name}')`;
          return `<div onclick="${onclick}" style="display:flex;align-items:center;gap:10px;padding:8px 12px;cursor:pointer;border-bottom:1px solid #1a1a1a;transition:background .15s;" onmouseover="this.style.background='#151515'" onmouseout="this.style.background='transparent'">
            <i data-lucide="${icon}" style="width:16px;height:16px;color:${color};flex-shrink:0;"></i>
            <span style="color:#ccc;font-size:13px;">${f.name}</span>
            ${size}
            ${modified}
          </div>`;
        }).join('');
        lucide.createIcons();
      } catch (e) {
        document.getElementById('projectFilesList').innerHTML = `
          <div style="color:#666;text-align:center;padding:20px;">
            <p>File browser API not connected</p>
            <p style="font-size:12px;margin-top:8px;color:#555;">Start: cd ~/projects/mission-control/server && npm start</p>
          </div>`;
      }
    }
    
    async function viewProjectFile(folderPath, filePath) {
      const fullPath = folderPath + '/' + filePath;
      const ext = filePath.split('.').pop().toLowerCase();
      const viewer = document.getElementById('projectFileViewer');
      
      if (!['md','txt','json','yaml','yml','js','ts','py','sh','css','html','csv','toml','env'].includes(ext)) {
        viewer.innerHTML = `<div style="color:#666;text-align:center;padding:20px;">Preview not available for .${ext} files</div>`;
        viewer.style.display = 'block';
        return;
      }
      
      try {
        const resp = await fetch(`${FILE_API}/api/file?path=${encodeURIComponent(fullPath)}`, {
          headers: { 'Authorization': `Bearer ${FILE_TOKEN}` }
        });
        if (!resp.ok) throw new Error('API error');
        const data = await resp.json();
        
        if (ext === 'md') {
          viewer.innerHTML = `<div style="color:#ccc;font-size:14px;line-height:1.7;">${renderMarkdown(data.content)}</div>`;
        } else {
          viewer.innerHTML = `<pre style="color:#ccc;font-size:13px;font-family:'SF Mono',Monaco,monospace;white-space:pre-wrap;word-break:break-all;margin:0;">${escapeHtml(data.content)}</pre>`;
        }
        viewer.style.display = 'block';
      } catch (e) {
        viewer.innerHTML = '<div style="color:#666;text-align:center;padding:20px;">Could not load file</div>';
        viewer.style.display = 'block';
      }
    }
    
    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }
    
    function escapeHtml(str) {
      return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    // Initialize daily logs on load
    loadDailyLogManifest();

    // Initialize Lucide icons
    lucide.createIcons();
  </script>
</body>
</html>
